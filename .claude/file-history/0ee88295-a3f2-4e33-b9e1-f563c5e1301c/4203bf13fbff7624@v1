#!/bin/bash
# Deprovision (remove) complete Supabase stack for a project
# Usage: ./deprovision-project-stack.sh <project-slug>

set -e

PROJECT_SLUG=$1

if [ -z "$PROJECT_SLUG" ]; then
  echo "Usage: $0 <project-slug>"
  exit 1
fi

echo "========================================"
echo "Deprovisioning Supabase Stack for Project"
echo "========================================"
echo "Slug: $PROJECT_SLUG"
echo ""

cd /home/ken/nextmavens-platform/docker

# Stop and remove containers
echo "Stopping containers..."
docker compose -f .stack-${PROJECT_SLUG}.yml down

# Remove generated files
echo "Removing configuration files..."
rm -f .stack-${PROJECT_SLUG}.yml
rm -f kong-${PROJECT_SLUG}.yml

echo ""
echo "Stack deprovisioned successfully!"
echo "Note: Database $DB_NAME is preserved. To delete the database:"
echo "  DROP DATABASE ${PROJECT_SLUG}_database CASCADE;"
