_format_version: "3.0"

services:
  # NextMavens Dashboard - must be first to catch / before /studio
  - name: dashboard
    url: http://dashboard:3000
    routes:
      - name: dashboard-root
        paths:
          - /              # Root path
          - /api            # Dashboard API
        strip_path: false
        plugins:
          - name: cors
            config:
              origins:
                - "*"
              methods:
                - GET
                - POST
                - PUT
                - DELETE
                - OPTIONS
              headers:
                - Accept
                - Accept-Language
                - Content-Type
                - Authorization
              exposed_headers:
                - Content-Length
                - Content-Type
              max_age: 3600

  # GoTrue Auth Service
  - name: gotrue
    url: http://gotrue:9999
    routes:
      - name: auth-route
        paths:
          - /auth/v1
        strip_path: true
        plugins:
          - name: cors
            config:
              origins:
                - "*"
                - "http://localhost:3000"
                - "http://localhost:3005"
                - "https://nextmavens.cloud"
              methods:
                - GET
                - POST
                - PUT
                - DELETE
                - PATCH
                - OPTIONS
              headers:
                - Accept
                - Accept-Language
                - Content-Type
                - Authorization
                - X-Client-Info
                - Apikey
              exposed_headers:
                - Content-Length
                - Content-Type
              max_age: 3600
              credentials: true

  # PostgREST API
  - name: postgrest
    url: http://rest:3000
    routes:
      - name: rest-route
        paths:
          - /rest/v1
        strip_path: true
        plugins:
          - name: cors
            config:
              origins:
                - "*"
              methods:
                - GET
                - POST
                - PUT
                - DELETE
                - PATCH
                - OPTIONS
              headers:
                - Accept
                - Accept-Language
                - Content-Type
                - Authorization
                - Apikey
              exposed_headers:
                - Content-Length
                - Content-Type
                - Content-Range
              max_age: 3600

  # NOTE: Studio is handled directly by nginx, not Kong
  # See /etc/nginx/sites-available/nextmavens.conf for Studio routing
