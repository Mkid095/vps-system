# Per-Project Studio Containers
# Each project gets its own Studio instance on a unique port
# Generated dynamically when projects are created

version: '3.8'

networks:
  nextmavens-network:
    external: true
    name: nextmavens-network

services:
  # Example: Project-specific Studio for project "nextmavens"
  # This will be generated dynamically per project
  studio-nextmavens:
    image: supabase/studio:latest
    container_name: nextmavens-studio-nextmavens
    environment:
      STUDIO_PG_META_URL: http://meta:8080
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
      DEFAULT_ORGANIZATION_NAME: NextMavens
      DEFAULT_PROJECT_NAME: nextmavens
      # Project-specific database connection
      PG_DATABASE: project_nextmavens_abc123def456
      PG_CONNECTION_STRING: postgres://postgres:${POSTGRES_PASSWORD:-postgres}@db:5432/project_nextmavens_abc123def456
    ports:
      - "3001:3000"  # Each Studio gets unique port
    networks:
      - nextmavens-network
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000/api/profile"]
      interval: 30s
      timeout: 10s
      retries: 3
    depends_on:
      db:
        condition: service_healthy
      meta:
        condition: service_healthy
