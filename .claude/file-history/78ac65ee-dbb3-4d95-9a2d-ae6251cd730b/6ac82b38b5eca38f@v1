---
project: Docker Infrastructure
branch: flow/docker-infrastructure
availableMCPs:
  - chrome-devtools
  - web-search-prime
---

# Docker Infrastructure

## Overview
Set up complete Docker infrastructure for NextMavens Platform. Version-pinned images for stability. Self-hosted Supabase, Evolution API, Redis, Kong gateway. Monitoring and storage optimization.

## Technical Approach
- Docker Compose for orchestration
- Separate compose files: supabase.yml, evolution.yml, all services
- Version-pinned images (monthly updates)
- Named volumes for persistence
- Health checks for all services
- Network isolation

## User Stories

### US-001: Supabase Docker Stack
**Priority:** 1
**Maven Steps:** [1, 7]
**MCP Tools:** []

As a platform operator, I want to run Supabase containers so that I have a self-hosted database.

**Acceptance Criteria:**
- docker/supabase.yml
- Services: db, studio, meta, realtime, storage, rest, supavisor, kong
- Version-pinned images
- Health checks configured
- Typecheck passes

**Status:** false

### US-002: Evolution API Docker Stack
**Priority:** 1
**Maven Steps:** [1, 7]
**MCP Tools:** []

As a platform operator, I want to run Evolution API so that I can provide WhatsApp services.

**Acceptance Criteria:**
- docker/evolution.yml
- Services: evolution, redis
- Version pinned: v2.3.7
- Webhook configuration via env
- Typecheck passes

**Status:** false

### US-003: Combined Docker Stack
**Priority:** 1
**Maven Steps:** [1, 7]
**MCP Tools:** []

As a platform operator, I want to run all services with one command so that deployment is simple.

**Acceptance Criteria:**
- docker/docker-compose.yml
- Includes all services
- Single network: nextmavens-network
- Named volumes for persistence
- Typecheck passes

**Status:** false

### US-004: Database Initialization
**Priority:** 1
**Maven Steps:** [1, 7]
**MCP Tools:** []

As the database container, I want to run init scripts so that the master schema is created.

**Acceptance Criteria:**
- scripts/db-init.sql mounted to /docker-entrypoint-initdb.d/
- Runs on first start
- Creates tables, functions, triggers
- Enables RLS
- Typecheck passes

**Status:** false

### US-005: Environment Configuration
**Priority:** 1
**Maven Steps:** [1, 7]
**MCP Tools:** []

As a platform operator, I want to configure services via env vars so that I can customize the deployment.

**Acceptance Criteria:**
- .env.example with all variables
- Docker Compose reads from .env
- Secrets documented
- Defaults for local dev
- Typecheck passes

**Status:** false

### US-006: Volume Management
**Priority:** 2
**Maven Steps:** [1, 7]
**MCP Tools:** []

As a platform operator, I want persistent volumes so that data survives container restarts.

**Acceptance Criteria:**
- Named volumes for: db data, storage, evolution data
- Backup script included
- Restore procedure documented
- Typecheck passes

**Status:** false

### US-007: Service Health Checks
**Priority:** 2
**Maven Steps:** [1, 7]
**MCP Tools:** []

As Docker Compose, I want to health check services so that unhealthy containers restart.

**Acceptance Criteria:**
- All services have healthcheck directive
- db: pg_isready
- redis: redis-cli ping
- evolution: wget localhost:8080
- Typecheck passes

**Status:** false

### US-008: Kong API Gateway Configuration
**Priority:** 2
**Maven Steps:** [1, 7]
**MCP Tools:** []

As the platform, I want Kong to route requests so that services are properly isolated.

**Acceptance Criteria:**
- Kong in DB-less mode
- Routes configured via API
- /studio/* → Studio container
- /api/* → API container
- Rate limiting plugin enabled
- Typecheck passes

**Status:** false

### US-009: Container Resource Limits
**Priority:** 3
**Maven Steps:** [1, 7]
**MCP Tools:** []

As a platform operator, I want to set resource limits so that no container consumes all resources.

**Acceptance Criteria:**
- Memory limits on all containers
- CPU reservations
- Container restart policies
- Typecheck passes

**Status:** false

### US-010: Log Management
**Priority:** 3
**Maven Steps:** [1, 7]
**MCP Tools:** []

As a platform operator, I want to access logs so that I can debug issues.

**Acceptance Criteria:**
- All containers log to stdout/stderr
- JSON log format
- Log rotation configured
- CLI can stream logs
- Typecheck passes

**Status:** false
