'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { useAuth, signOut } from '@/lib/store';

interface NavItem {
  href: string;
  label: string;
  icon: string;
}

const navItems: NavItem[] = [
  { href: '/', label: 'Home', icon: '[H]' },
  { href: '/databases', label: 'Databases', icon: '[D]' },
  { href: '/whatsapp', label: 'WhatsApp', icon: '[W]' },
  { href: '/deploy', label: 'Deploy', icon: '[P]' },
  { href: '/backup', label: 'Backup', icon: '[B]' },
  { href: '/emails', label: 'Emails', icon: '[E]' },
];

export function Sidebar() {
  const pathname = usePathname();
  const { user } = useAuth();

  const handleLogout = async () => {
    await signOut();
    window.location.href = '/auth/signin';
  };

  return (
    <aside className="sidebar">
      {/* Logo */}
      <div className="sidebar-header">
        <Link href="/" className="logo-link">
          <img
            src="https://www.nextmavens.com/logo-colored.png"
            alt="NextMavens"
            className="logo-image"
          />
        </Link>
      </div>

      {/* VPS Stats */}
      <div className="vps-stats">
        <VPSStat label="DISK" value="--" />
        <VPSStat label="CPU" value="--" />
        <VPSStat label="RAM" value="--" />
        <VPSStat label="NET" value="--" />
      </div>

      {/* Navigation */}
      <nav className="sidebar-nav">
        <ul className="nav-list">
          {navItems.map((item) => {
            const isActive = pathname === item.href;
            return (
              <li key={item.href}>
                <Link
                  href={item.href}
                  className={`nav-item ${isActive ? 'active' : ''}`}
                >
                  <span className="nav-icon mono">{item.icon}</span>
                  <span className="nav-label">{item.label}</span>
                </Link>
              </li>
            );
          })}
        </ul>
      </nav>

      {/* User section */}
      {user && (
        <div className="sidebar-footer">
          <div className="user-info">
            <span className="user-email mono">{user.email}</span>
          </div>
          <button
            onClick={handleLogout}
            className="logout-btn btn-ghost"
          >
            <span className="mono">[X]</span>
            <span>Logout</span>
          </button>
        </div>
      )}
    </aside>
  );
}

function VPSStat({ label, value }: { label: string; value: string }) {
  return (
    <div className="vps-stat">
      <span className="vps-stat-label mono text-muted">{label}</span>
      <span className="vps-stat-value mono">{value}</span>
    </div>
  );
}

export function sidebarStyles() {
  return (
    <style>{`
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 240px;
        height: 100vh;
        background: var(--sidebar-bg);
        border-right: 1px solid var(--sidebar-border);
        display: flex;
        flex-direction: column;
        z-index: 50;
      }

      .sidebar-header {
        padding: 1rem;
        border-bottom: 1px solid var(--sidebar-border);
      }

      .logo-link {
        display: flex;
        align-items: center;
        text-decoration: none;
      }

      .logo-image {
        width: 32px;
        height: 32px;
        object-fit: contain;
      }

      .vps-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
        padding: 1rem;
        border-bottom: 1px solid var(--sidebar-border);
      }

      .vps-stat {
        display: flex;
        flex-direction: column;
        gap: 0.125rem;
      }

      .vps-stat-label {
        font-size: 0.625rem;
        letter-spacing: 0.1em;
      }

      .vps-stat-value {
        font-size: 0.75rem;
        color: var(--primary);
      }

      .sidebar-nav {
        flex: 1;
        overflow-y: auto;
        padding: 0.5rem 0;
      }

      .nav-list {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.625rem 1rem;
        margin: 0.125rem 0.5rem;
        border-radius: 0.375rem;
        color: var(--foreground-muted);
        text-decoration: none;
        font-size: 0.875rem;
        transition: all 0.15s ease;
      }

      .nav-item:hover {
        background: var(--sidebar-hover);
        color: var(--foreground);
      }

      .nav-item.active {
        background: var(--sidebar-active);
        color: var(--primary);
      }

      .nav-icon {
        font-size: 0.75rem;
        opacity: 0.8;
      }

      .nav-label {
        font-weight: 500;
      }

      .sidebar-footer {
        padding: 1rem;
        border-top: 1px solid var(--sidebar-border);
      }

      .user-info {
        margin-bottom: 0.75rem;
      }

      .user-email {
        display: block;
        font-size: 0.75rem;
        color: var(--foreground-muted);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .logout-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        width: 100%;
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        color: var(--foreground-muted);
        background: transparent;
        border: 1px solid transparent;
        border-radius: 0.375rem;
        cursor: pointer;
        transition: all 0.15s ease;
      }

      .logout-btn:hover {
        background: var(--sidebar-hover);
        color: var(--error);
      }
    `}</style>
  );
}
