---
project: Platform Core (Supabase Foundation)
branch: flow/platform-core
availableMCPs:
  - supabase
  - chrome-devtools
  - web-search-prime
---

# Platform Core (Supabase Foundation)

## Overview
Self-host Supabase with Docker for the NextMavens Platform. Implement custom organizations→projects flow with database-per-app isolation (NOT schema-based). Configure Supavisor for connection pooling and Kong API gateway for routing. Provide Supabase Studio access for admin operations.

## Technical Approach
- Single Supabase instance with separate databases per project
- Supavisor config: `POOLER_TENANT_ID=nextmavens_master`, `pool_mode=transaction`
- Connection string format: `postgres://postgres.${tenant_id}:${password}@db:5432/${db_name}`
- Custom API layer uses postgres client to run `CREATE DATABASE "project_${id}"; CREATE ROLE ...; GRANT ...;` transactionally
- Project-scoped JWTs via Supabase Auth admin API or custom signing with project-specific secrets
- Studio access via Kong proxy: path `/studio/{project}` → upstream to Studio container with header injection
- Subdomain routing: `app.nextmavens.cloud` + custom domains

## User Stories

### US-001: Create Organization
**Priority:** 1
**Maven Steps:** [1, 7, 10]
**MCP Tools:** ["supabase"]

As a platform administrator, I want to create an organization so that I can group related projects and manage team access.

**Acceptance Criteria:**
- Organization has unique slug
- Creator is assigned owner role
- Organization record stored in master database
- API endpoint: POST /api/orgs with {name, slug?}
- Typecheck passes
- RLS policies enable org member access

**Status:** false

### US-002: Create Project with Database
**Priority:** 1
**Maven Steps:** [1, 7, 10]
**MCP Tools:** ["supabase"]

As a platform administrator, I want to create a project within an organization so that it gets an isolated PostgreSQL database with unique credentials.

**Acceptance Criteria:**
- Project has unique slug within organization
- PostgreSQL database created: `project_{uuid}` (hyphens replaced with underscores)
- Database role created: `app_{uuid}`
- Random password generated and stored encrypted
- API keys generated (anon/service_role)
- Connection string returned
- Studio accessible via /studio/{slug}
- Typecheck passes

**Status:** false

### US-003: List Organizations
**Priority:** 1
**Maven Steps:** [1, 7]
**MCP Tools:** []

As a logged-in user, I want to see all organizations I belong to so that I can navigate to my projects.

**Acceptance Criteria:**
- Returns organizations where user is a member
- Includes user's role in each organization
- API endpoint: GET /api/orgs
- Typecheck passes

**Status:** false

### US-004: List Projects
**Priority:** 1
**Maven Steps:** [1, 7]
**MCP Tools:** []

As a logged-in user, I want to see all projects I have access to so that I can manage my applications.

**Acceptance Criteria:**
- Returns projects from user's organizations
- Filterable by organization_id and status
- API endpoint: GET /api/projects?org_id={id}
- Typecheck passes

**Status:** false

### US-005: Get Project Details
**Priority:** 2
**Maven Steps:** [1, 7]
**MCP Tools:** []

As a developer, I want to retrieve project details including API keys and database credentials so that I can configure my application.

**Acceptance Criteria:**
- Returns project metadata
- Returns WhatsApp instances
- Returns active API keys (without secrets)
- Returns project settings
- API endpoint: GET /api/projects/{id}
- Typecheck passes

**Status:** false

### US-006: Supabase Studio Access
**Priority:** 2
**Maven Steps:** [1, 7]
**MCP Tools:** []

As a developer, I want to access Supabase Studio for my project so that I can visually manage my database.

**Acceptance Criteria:**
- Kong routes /studio/{slug} to Studio container
- Project database context injected via headers
- Authentication required
- Typecheck passes

**Status:** false

### US-007: Invite Organization Member
**Priority:** 2
**Maven Steps:** [1, 7, 10]
**MCP Tools:** ["supabase"]

As an organization owner, I want to invite team members so that they can access projects.

**Acceptance Criteria:**
- Member receives invitation
- Role can be owner/admin/member/viewer
- Member can see organization after accepting
- Typecheck passes

**Status:** false

### US-008: Update Project Status
**Priority:** 3
**Maven Steps:** [1, 7]
**MCP Tools:** []

As an administrator, I want to suspend or archive projects so that I can manage unused applications.

**Acceptance Criteria:**
- Status can be: provisioning/active/suspended/archived
- Suspended projects cannot receive API requests
- Database connections disabled when suspended
- Typecheck passes

**Status:** false
