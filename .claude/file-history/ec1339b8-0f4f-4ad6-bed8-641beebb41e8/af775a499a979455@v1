{
  "project": "MCP Servers for Claude Integration",
  "branchName": "flow/mcp-servers",
  "description": "Implement stdio-based MCP (Model Context Protocol) servers for Supabase, WhatsApp (Evolution API), and Email (Resend). Enable Claude Desktop to interact with platform services. Secure connection management with per-project credentials.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Supabase MCP Handshake",
      "description": "As the MCP protocol, I want to establish a handshake so that the client knows the server is ready.",
      "acceptanceCriteria": [
        "Server outputs handshake on startup",
        "Format: {\"type\": \"handshake\", \"version\": \"1.0\"}",
        "Accepts newline-delimited JSON input",
        "Typecheck passes"
      ],
      "mavenSteps": [1, 7],
      "mcpTools": {},
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Supabase MCP Query Action",
      "description": "As Claude Desktop, I want to query Supabase tables so that I can retrieve data for analysis.",
      "acceptanceCriteria": [
        "Action: query",
        "Params: {projectId, token, table, limit?, filter?}",
        "Validates token and retrieves project credentials",
        "Executes SELECT query",
        "Returns data array",
        "Typecheck passes"
      ],
      "mavenSteps": [1, 7, 10],
      "mcpTools": {
        "step1": ["supabase"],
        "step7": ["supabase"],
        "step10": ["supabase"]
      },
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Supabase MCP Execute Action",
      "description": "As Claude Desktop, I want to execute safe SQL so that I can perform complex queries.",
      "acceptanceCriteria": [
        "Action: execute",
        "Params: {projectId, token, sql}",
        "Whitelisted SQL only (SELECT, limited INSERT/UPDATE)",
        "Query result limits",
        "Returns rows/affected count",
        "Typecheck passes"
      ],
      "mavenSteps": [1, 7, 10],
      "mcpTools": {
        "step1": ["supabase"],
        "step7": ["supabase"],
        "step10": ["supabase"]
      },
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "WhatsApp MCP Send Message",
      "description": "As Claude Desktop, I want to send WhatsApp messages so that I can notify users.",
      "acceptanceCriteria": [
        "Action: send-message",
        "Params: {instanceName, number, text}",
        "Calls Evolution API",
        "Returns message ID",
        "Typecheck passes"
      ],
      "mavenSteps": [1, 7, 10],
      "mcpTools": {},
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "WhatsApp MCP Get Status",
      "description": "As Claude Desktop, I want to check WhatsApp status so that I can verify connectivity.",
      "acceptanceCriteria": [
        "Action: get-status",
        "Params: {instanceName}",
        "Returns state, phone number, battery",
        "Typecheck passes"
      ],
      "mavenSteps": [1, 7],
      "mcpTools": {},
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "WhatsApp MCP Create Instance",
      "description": "As Claude Desktop, I want to create WhatsApp instances so that I can set up new connections.",
      "acceptanceCriteria": [
        "Action: create-instance",
        "Params: {instanceName}",
        "Calls Evolution API",
        "Returns instance ID",
        "Typecheck passes"
      ],
      "mavenSteps": [1, 7, 10],
      "mcpTools": {},
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Email MCP Send Email",
      "description": "As Claude Desktop, I want to send emails via Resend so that I can communicate with users.",
      "acceptanceCriteria": [
        "Action: send-email",
        "Params: {to, subject, html?, text?}",
        "Calls Resend API",
        "Returns message ID",
        "Typecheck passes"
      ],
      "mavenSteps": [1, 7, 10],
      "mcpTools": {},
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "MCP Authentication",
      "description": "As the MCP server, I want to validate requests so that unauthorized clients cannot access data.",
      "acceptanceCriteria": [
        "Each request includes project token",
        "Token validated against master database",
        "Project credentials retrieved",
        "Invalid tokens return error",
        "Typecheck passes"
      ],
      "mavenSteps": [1, 10],
      "mcpTools": {
        "step1": ["supabase"],
        "step10": ["supabase"]
      },
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "MCP Error Handling",
      "description": "As the MCP server, I want to return structured errors so that clients can handle failures gracefully.",
      "acceptanceCriteria": [
        "Error format: {\"type\": \"error\", \"message\": \"...\", \"code\": \"...\"}",
        "Catches all exceptions",
        "Logs errors for debugging",
        "Process continues after error",
        "Typecheck passes"
      ],
      "mavenSteps": [1, 7],
      "mcpTools": {},
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "MCP Manifest/Capabilities",
      "description": "As Claude Desktop, I want to discover available actions so that I know what the server can do.",
      "acceptanceCriteria": [
        "Action: capabilities",
        "Returns list of actions and their params",
        "Optional: events for subscriptions",
        "Typecheck passes"
      ],
      "mavenSteps": [1, 7],
      "mcpTools": {},
      "priority": 3,
      "passes": false,
      "notes": ""
    }
  ]
}
