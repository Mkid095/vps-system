     1→// NextMavens Platform API - Organizations Endpoint
     2→// POST /api/orgs - Create organization
     3→// GET /api/orgs - List user's organizations
     4→
     5→import { NextRequest } from 'next/server';
     6→import { withAuthAndError, validators } from '@/lib/middleware';
     7→import {
     8→  getUserOrganizations,
     9→  createOrganization,
    10→  getUserOrganizationsPaginated,
    11→} from '@/lib/db/organizations';
    12→import type { CreateOrganizationInput } from '@/lib/types';
    13→
    14→// GET /api/orgs - List organizations
    15→export async function GET(req: NextRequest) {
    16→  return withAuthAndError(async (user) => {
    17→    const url = new URL(req.url);
    18→    const page = parseInt(url.searchParams.get('page') || '1', 10);
    19→    const perPage = parseInt(url.searchParams.get('per_page') || '10', 10);
    20→
    21→    if (page > 1 || perPage !== 10) {
    22→      // Use pagination
    23→      const result = await getUserOrganizationsPaginated(user.id, { page, perPage });
    24→      return {
    25→        items: result.items,
    26→        total: result.total,
    27→        page: result.page,
    28→        per_page: result.perPage,
    29→        total_pages: result.totalPages,
    30→      };
    31→    }
    32→
    33→    // Use simple list
    34→    const organizations = await getUserOrganizations(user.id);
    35→    return {
    36→      items: organizations,
    37→      total: organizations.length,
    38→    };
    39→  })(req);
    40→}
    41→
    42→// POST /api/orgs - Create organization
    43→export async function POST(req: NextRequest) {
    44→  return withAuthAndError(async (user) => {
    45→    const body = await req.json();
    46→
    47→    // Validate name
    48→    if (!body.name || typeof body.name !== 'string') {
    49→      throw new Error('Name is required');
    50→    }
    51→
    52→    const name = body.name.trim();
    53→    if (name.length < 2) {
    54→      throw new Error('Name must be at least 2 characters');
    55→    }
    56→
    57→    if (name.length > 100) {
    58→      throw new Error('Name must be less than 100 characters');
    59→    }
    60→
    61→    // Validate slug if provided
    62→    let slug: string | undefined;
    63→    if (body.slug) {
    64→      if (!validators.slug(body.slug)) {
    65→        throw new Error('Slug must contain only lowercase letters, numbers, and hyphens');
    66→      }
    67→      slug = body.slug;
    68→    }
    69→
    70→    // Validate logo_url if provided
    71→    let logo_url: string | undefined;
    72→    if (body.logo_url) {
    73→      if (!validators.url(body.logo_url)) {
    74→        throw new Error('logo_url must be a valid URL');
    75→      }
    76→      logo_url = body.logo_url;
    77→    }
    78→
    79→    const input: CreateOrganizationInput = {
    80→      name,
    81→      slug,
    82→      logo_url,
    83→    };
    84→
    85→    const org = await createOrganization(input, user.id);
    86→
    87→    return org;
    88→  })(req);
    89→}
    90→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
