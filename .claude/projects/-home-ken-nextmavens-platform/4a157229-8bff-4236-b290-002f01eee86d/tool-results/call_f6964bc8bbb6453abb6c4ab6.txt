{"args":[0.02038609],"component":"pop","level":"info","msg":"%.4f seconds","time":"2026-01-25T07:26:25Z"}
{"level":"fatal","msg":"running db migrations: error executing migrations/20250804100000_add_oauth_authorizations_consents.up.sql, sql: -- Create OAuth 2.1 support with enums, authorization, and consent tables\n\n-- Create enums for OAuth authorization management\ndo $$ begin\n    create type auth.oauth_authorization_status as enum('pending', 'approved', 'denied', 'expired');\nexception\n    when duplicate_object then null;\nend $$;\n\ndo $$ begin\n    create type auth.oauth_response_type as enum('code');\nexception\n    when duplicate_object then null;\nend $$;\n\n-- Create oauth_authorizations table for OAuth 2.1 authorization requests\ncreate table if not exists auth.oauth_authorizations (\n    id uuid not null,\n    authorization_id text not null,\n    client_id uuid not null references auth.oauth_clients(id) on delete cascade,\n    user_id uuid null references auth.users(id) on delete cascade,\n    redirect_uri text not null,\n    scope text not null,\n    state text null,\n    resource text null,\n    code_challenge text null,\n    code_challenge_method auth.code_challenge_method null,\n    response_type auth.oauth_response_type not null default 'code',\n    \n    -- Flow control\n    status auth.oauth_authorization_status not null default 'pending',\n    authorization_code text null,\n    \n    -- Timestamps\n    created_at timestamptz not null default now(),\n    expires_at timestamptz not null default (now() + interval '3 minutes'),\n    approved_at timestamptz null,\n    \n    constraint oauth_authorizations_pkey primary key (id),\n    constraint oauth_authorizations_authorization_id_key unique (authorization_id),\n    constraint oauth_authorizations_authorization_code_key unique (authorization_code),\n    constraint oauth_authorizations_redirect_uri_length check (char_length(redirect_uri) \u003c= 2048),\n    constraint oauth_authorizations_scope_length check (char_length(scope) \u003c= 4096),\n    constraint oauth_authorizations_state_length check (char_length(state) \u003c= 4096),\n    constraint oauth_authorizations_resource_length check (char_length(resource) \u003c= 2048),\n    constraint oauth_authorizations_code_challenge_length check (char_length(code_challenge) \u003c= 128),\n    constraint oauth_authorizations_authorization_code_length check (char_length(authorization_code) \u003c= 255),\n    constraint oauth_authorizations_expires_at_future check (expires_at \u003e created_at)\n);\n\n-- Create indexes for oauth_authorizations\n--  for CleanupExpiredOAuthServerAuthorizations\ncreate index if not exists oauth_auth_pending_exp_idx\n    on auth.oauth_authorizations (expires_at)\n    where status = 'pending';\n\n\n\n-- Create oauth_consents table for user consent management\ncreate table if not exists auth.oauth_consents (\n    id uuid not null,\n    user_id uuid not null references auth.users(id) on delete cascade,\n    client_id uuid not null references auth.oauth_clients(id) on delete cascade,\n    scopes text not null,\n    granted_at timestamptz not null default now(),\n    revoked_at timestamptz null,\n    \n    constraint oauth_consents_pkey primary key (id),\n    constraint oauth_consents_user_client_unique unique (user_id, client_id),\n    constraint oauth_consents_scopes_length check (char_length(scopes) \u003c= 2048),\n    constraint oauth_consents_scopes_not_empty check (char_length(trim(scopes)) \u003e 0),\n    constraint oauth_consents_revoked_after_granted check (revoked_at is null or revoked_at \u003e= granted_at)\n);\n\n-- Create indexes for oauth_consents\n-- Active consent look-up (user + client, only non-revoked rows)\ncreate index if not exists oauth_consents_active_user_client_idx\n    on auth.oauth_consents (user_id, client_id)\n    where revoked_at is null;\n\n-- \"Show me all consents for this user, newest first\"\ncreate index if not exists oauth_consents_user_order_idx\n    on auth.oauth_consents (user_id, granted_at desc);\n\n-- Bulk revoke for an entire client (only non-revoked rows)\ncreate index if not exists oauth_consents_active_client_idx\n    on auth.oauth_consents (client_id)\n    where revoked_at is null;\n: ERROR: type \"auth.code_challenge_method\" does not exist (SQLSTATE 42704)","time":"2026-01-25T07:26:25Z"}
{"level":"info","msg":"Go runtime metrics collection started","time":"2026-01-25T07:26:32Z"}
{"args":[0.018375544],"component":"pop","level":"info","msg":"%.4f seconds","time":"2026-01-25T07:26:32Z"}
{"level":"fatal","msg":"running db migrations: error executing migrations/20250804100000_add_oauth_authorizations_consents.up.sql, sql: -- Create OAuth 2.1 support with enums, authorization, and consent tables\n\n-- Create enums for OAuth authorization management\ndo $$ begin\n    create type auth.oauth_authorization_status as enum('pending', 'approved', 'denied', 'expired');\nexception\n    when duplicate_object then null;\nend $$;\n\ndo $$ begin\n    create type auth.oauth_response_type as enum('code');\nexception\n    when duplicate_object then null;\nend $$;\n\n-- Create oauth_authorizations table for OAuth 2.1 authorization requests\ncreate table if not exists auth.oauth_authorizations (\n    id uuid not null,\n    authorization_id text not null,\n    client_id uuid not null references auth.oauth_clients(id) on delete cascade,\n    user_id uuid null references auth.users(id) on delete cascade,\n    redirect_uri text not null,\n    scope text not null,\n    state text null,\n    resource text null,\n    code_challenge text null,\n    code_challenge_method auth.code_challenge_method null,\n    response_type auth.oauth_response_type not null default 'code',\n    \n    -- Flow control\n    status auth.oauth_authorization_status not null default 'pending',\n    authorization_code text null,\n    \n    -- Timestamps\n    created_at timestamptz not null default now(),\n    expires_at timestamptz not null default (now() + interval '3 minutes'),\n    approved_at timestamptz null,\n    \n    constraint oauth_authorizations_pkey primary key (id),\n    constraint oauth_authorizations_authorization_id_key unique (authorization_id),\n    constraint oauth_authorizations_authorization_code_key unique (authorization_code),\n    constraint oauth_authorizations_redirect_uri_length check (char_length(redirect_uri) \u003c= 2048),\n    constraint oauth_authorizations_scope_length check (char_length(scope) \u003c= 4096),\n    constraint oauth_authorizations_state_length check (char_length(state) \u003c= 4096),\n    constraint oauth_authorizations_resource_length check (char_length(resource) \u003c= 2048),\n    constraint oauth_authorizations_code_challenge_length check (char_length(code_challenge) \u003c= 128),\n    constraint oauth_authorizations_authorization_code_length check (char_length(authorization_code) \u003c= 255),\n    constraint oauth_authorizations_expires_at_future check (expires_at \u003e created_at)\n);\n\n-- Create indexes for oauth_authorizations\n--  for CleanupExpiredOAuthServerAuthorizations\ncreate index if not exists oauth_auth_pending_exp_idx\n    on auth.oauth_authorizations (expires_at)\n    where status = 'pending';\n\n\n\n-- Create oauth_consents table for user consent management\ncreate table if not exists auth.oauth_consents (\n    id uuid not null,\n    user_id uuid not null references auth.users(id) on delete cascade,\n    client_id uuid not null references auth.oauth_clients(id) on delete cascade,\n    scopes text not null,\n    granted_at timestamptz not null default now(),\n    revoked_at timestamptz null,\n    \n    constraint oauth_consents_pkey primary key (id),\n    constraint oauth_consents_user_client_unique unique (user_id, client_id),\n    constraint oauth_consents_scopes_length check (char_length(scopes) \u003c= 2048),\n    constraint oauth_consents_scopes_not_empty check (char_length(trim(scopes)) \u003e 0),\n    constraint oauth_consents_revoked_after_granted check (revoked_at is null or revoked_at \u003e= granted_at)\n);\n\n-- Create indexes for oauth_consents\n-- Active consent look-up (user + client, only non-revoked rows)\ncreate index if not exists oauth_consents_active_user_client_idx\n    on auth.oauth_consents (user_id, client_id)\n    where revoked_at is null;\n\n-- \"Show me all consents for this user, newest first\"\ncreate index if not exists oauth_consents_user_order_idx\n    on auth.oauth_consents (user_id, granted_at desc);\n\n-- Bulk revoke for an entire client (only non-revoked rows)\ncreate index if not exists oauth_consents_active_client_idx\n    on auth.oauth_consents (client_id)\n    where revoked_at is null;\n: ERROR: type \"auth.code_challenge_method\" does not exist (SQLSTATE 42704)","time":"2026-01-25T07:26:32Z"}