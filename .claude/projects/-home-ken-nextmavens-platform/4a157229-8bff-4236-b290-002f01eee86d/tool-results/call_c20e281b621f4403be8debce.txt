     1→# NextMavens Self-Hosted Supabase
     2→# Simplified version with available components
     3→networks:
     4→  supabase-network:
     5→    driver: bridge
     6→    name: supabase-network
     7→
     8→volumes:
     9→  supabase-db-data:
    10→    name: supabase-db-data
    11→  supabase-storage:
    12→    name: supabase-storage
    13→
    14→services:
    15→  # PostgreSQL Database (Master DB + Project DBs)
    16→  db:
    17→    image: pgvector/pgvector:pg16
    18→    container_name: supabase-db
    19→    hostname: db
    20→    ports:
    21→      - "5432:5432"
    22→    environment:
    23→      POSTGRES_USER: postgres
    24→      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
    25→      POSTGRES_DB: postgres
    26→    volumes:
    27→      - supabase-db-data:/var/lib/postgresql/data
    28→      - ./scripts/00-init.sql:/docker-entrypoint-initdb.d/00-init.sql
    29→    networks:
    30→      - supabase-network
    31→    restart: unless-stopped
    32→    healthcheck:
    33→      test: ["CMD-SHELL", "pg_isready -U postgres -h localhost"]
    34→      interval: 10s
    35→      timeout: 5s
    36→      retries: 5
    37→
    38→  # Supabase Studio (Admin UI) - using latest stable
    39→  studio:
    40→    image: supabase/studio:latest
    41→    container_name: supabase-studio
    42→    ports:
    43→      - "8000:3000"
    44→    environment:
    45→      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
    46→      DEFAULT_ORGANIZATION_NAME: NextMavens
    47→      DEFAULT_PROJECT_NAME: Master
    48→      # Direct connection to Postgres
    49→      PG_CONNECTION_STRING: postgres://postgres:${POSTGRES_PASSWORD:-postgres}@db:5432/postgres
    50→      # Auth service
    51→      GOTRUE_URL: http://gotrue:9999
    52→      GATEWAY_EXTERNAL_URL: https://nextmavens.cloud
    53→    networks:
    54→      - supabase-network
    55→    restart: unless-stopped
    56→    depends_on:
    57→      db:
    58→        condition: service_healthy
    59→      gotrue:
    60→        condition: service_started
    61→
    62→  # Supavisor (Connection Pooling)
    63→  supavisor:
    64→    image: supabase/supavisor:1.1.51
    65→    container_name: supabase-supavisor
    66→    ports:
    67→      - "4000:4000"
    68→    environment:
    69→      PORT: 4000
    70→      DB_HOST: db
    71→      DB_PORT: 5432
    72→      DB_USER: postgres
    73→      DB_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
    74→      DB_NAME: postgres
    75→      POOL_MODE: transaction
    76→      POOLER_DEFAULT_POOL_SIZE: 15
    77→      POOLER_MAX_CLIENT_CONN: 100
    78→      TENANT_ID: nextmavens_master
    79→      SECRET_KEY_BASE: ${SUPAVISOR_SECRET_KEY:-change-me-in-production}
    80→      API_JWT_SECRET: ${JWT_SECRET:-change-me-in-production}
    81→    networks:
    82→      - supabase-network
    83→    restart: unless-stopped
    84→    depends_on:
    85→      db:
    86→        condition: service_healthy
    87→
    88→  # Realtime (WebSocket subscriptions)
    89→  realtime:
    90→    image: supabase/realtime:v2.30.8
    91→    container_name: supabase-realtime
    92→    ports:
    93→      - "4001:4000"
    94→    environment:
    95→      PORT: 4000
    96→      APP_NAME: realtime
    97→      DB_HOST: db
    98→      DB_PORT: 5432
    99→      DB_USER: postgres
   100→      DB_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
   101→      DB_NAME: postgres
   102→      DB_AFTER_CONNECT_QUERY: 'SET search_path TO _realtime'
   103→      JWT_SECRET: ${JWT_SECRET:-change-me-in-production}
   104→      SECRET_KEY_BASE: ${REALTIME_SECRET_KEY:-change-me-in-production}
   105→      RLIMIT_NOFILE: 65536
   106→    networks:
   107→      - supabase-network
   108→    restart: unless-stopped
   109→    depends_on:
   110→      db:
   111→        condition: service_healthy
   112→
   113→  # Storage API
   114→  storage:
   115→    image: supabase/storage-api:v1.33.5
   116→    container_name: supabase-storage
   117→    ports:
   118→      - "4002:5000"
   119→    environment:
   120→      ANON_KEY: ${ANON_KEY:-eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.anon}
   121→      SERVICE_KEY: ${SERVICE_KEY:-eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.service}
   122→      POSTGREST_URL: http://rest:3000
   123→      DATABASE_URL: postgres://postgres:${POSTGRES_PASSWORD:-postgres}@db:5432/postgres
   124→      FILE_SIZE_LIMIT: 52428800
   125→      STORAGE_BACKEND: file
   126→      FILE_STORAGE_BACKEND_PATH: /var/lib/storage
   127→      TENANT_ID: stub
   128→      REGION: stub
   129→      GLOBAL_S3_BUCKET: stub
   130→      PGRST_JWT_SECRET: ${JWT_SECRET:-change-me-in-production}
   131→    volumes:
   132→      - supabase-storage:/var/lib/storage
   133→    networks:
   134→      - supabase-network
   135→    restart: unless-stopped
   136→    depends_on:
   137→      db:
   138→        condition: service_healthy
   139→
   140→  # PostgREST (REST API)
   141→  rest:
   142→    image: postgrest/postgrest:v12.2.0
   143→    container_name: supabase-rest
   144→    ports:
   145→      - "4003:3000"
   146→    environment:
   147→      PGRST_DB_URI: postgres://postgres:${POSTGRES_PASSWORD:-postgres}@db:5432/postgres
   148→      PGRST_DB_SCHEMAS: public
   149→      PGRST_DB_ANON_ROLE: anon
   150→      PGRST_JWT_SECRET: ${JWT_SECRET:-change-me-in-production}
   151→      PGRST_SERVER_TRACE_ENABLED: false
   152→    networks:
   153→      - supabase-network
   154→    restart: unless-stopped
   155→    depends_on:
   156→      db:
   157→        condition: service_healthy
   158→
   159→  # GoTrue (Auth Service)
   160→  gotrue:
   161→    image: supabase/gotrue:v2.158.5
   162→    container_name: supabase-gotrue
   163→    ports:
   164→      - "9999:9999"
   165→    environment:
   166→      PORT: 9999
   167→      GOTRUE_API_HOST: 0.0.0.0
   168→      GOTRUE_API_PORT: 9999
   169→      API_EXTERNAL_URL: https://nextmavens.cloud
   170→      DATABASE_URL: postgres://postgres:${POSTGRES_PASSWORD:-postgres}@db:5432/postgres
   171→      GOTRUE_DB_DRIVER: postgres
   172→      GOTRUE_JWT_SECRET: ${JWT_SECRET:-change-me-in-production}
   173→      GOTRUE_JWT_EXP: 3600
   174→      GOTRUE_JWT_DEFAULT_GROUP_NAME: authenticated
   175→      GOTRUE_SITE_URL: https://nextmavens.cloud
   176→      GOTRUE_URI_ALLOW_LIST: '*'
   177→      GOTRUE_DISABLE_SIGNUP: false
   178→      GOTRUE_EMAIL_SIGNUP_ENABLED: true
   179→      GOTRUE_SMS_AUTOCONFIRM: true
   180→      GOTRUE_EMAIL_AUTOCONFIRM: true
   181→      GOTRUE_SMTP_HOST: mailhog
   182→      GOTRUE_SMTP_PORT: 1025
   183→      GOTRUE_SMTP_USER: ""
   184→      GOTRUE_SMTP_PASS: ""
   185→      GOTRUE_SMTP_ADMIN_EMAIL: admin@nextmavens.cloud
   186→      GOTRUE_MAILER_URLPATHS_CONFIRMATION: /auth/v1/verify
   187→      GOTRUE_MAILER_URLPATHS_INVITE: /auth/v1/verify
   188→      GOTRUE_MAILER_URLPATHS_RECOVERY: /auth/v1/verify
   189→      GOTRUE_MAILER_URLPATHS_EMAIL_CHANGE: /auth/v1/verify
   190→    networks:
   191→      - supabase-network
   192→    restart: unless-stopped
   193→    depends_on:
   194→      db:
   195→        condition: service_healthy
   196→
   197→  # Kong API Gateway
   198→  kong:
   199→    image: kong:3.7.1
   200→    container_name: supabase-kong
   201→    ports:
   202→      - "8001:8001"
   203→      - "8443:8443"
   204→    environment:
   205→      KONG_DATABASE: "off"
   206→      KONG_PROXY_ACCESS_LOG: /dev/stdout
   207→      KONG_ADMIN_ACCESS_LOG: /dev/stdout
   208→      KONG_PROXY_ERROR_LOG: /dev/stderr
   209→      KONG_ADMIN_ERROR_LOG: /dev/stderr
   210→      KONG_LOG_LEVEL: warn
   211→      KONG_PLUGINS: session,rate-limiting
   212→    networks:
   213→      - supabase-network
   214→    restart: unless-stopped
   215→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
