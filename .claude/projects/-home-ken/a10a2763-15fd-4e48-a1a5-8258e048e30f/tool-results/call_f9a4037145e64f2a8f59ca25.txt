     1→---
     2→description: Run Maven Flow - autonomous AI development with PRD-driven iteration and 10-step workflow
     3→argument-hint: start [max-iterations] | status | continue [prd-name] | reset [prd-name] | test [prd-name] | consolidate [prd-name] | help
     4→---
     5→
     6→# Maven Flow
     7→
     8→Autonomous AI development flow that implements PRD stories using the Maven 10-Step Workflow. Supports multiple feature PRDs with automatic story tracking and completion.
     9→
    10→**Multi-PRD Architecture:** Each feature has its own `docs/prd-[feature-name].json` file. The flow automatically scans for incomplete PRDs and processes them in order.
    11→
    12→## Commands
    13→
    14→### Start a new flow
    15→```
    16→/flow start [max-iterations]
    17→```
    18→
    19→**CRITICAL: This command runs AUTOMATICALLY until ALL stories complete**
    20→
    21→**Architecture:** The `/flow` command (running in main Claude context) coordinates ALL specialist agent spawning directly. Subagents are NOT used for coordination since they cannot spawn other subagents.
    22→
    23→---
    24→
    25→## Prerequisites Check
    26→
    27→Before starting, the command validates:
    28→
    29→1. **`docs/` directory exists**
    30→   - If missing: `❌ Error: No docs/ directory found.`
    31→   - Fix: Create the directory: `mkdir docs`
    32→
    33→2. **PRD files exist** (`docs/prd-*.json`)
    34→   - If missing: `❌ Error: No PRD files found in docs/.`
    35→   - Fix: Create a PRD first using the `flow-prd` skill:
    36→     ```
    37→     Tell me you want to create a PRD for [feature]
    38→     Example: "Create a PRD for a user authentication feature"
    39→     ```
    40→
    41→3. **At least one incomplete story**
    42→   - If all PRDs complete: `✅ All PRDs complete! No work to do.`
    43→   - Fix: Create a new PRD or add stories to existing PRD
    44→
    45→4. **Maven Flow wrapper script** (optional, for local execution)
    46→   - The flow can create `maven-flow.sh` locally for direct execution
    47→   - This wrapper is created automatically when needed
    48→   - If you encounter syntax errors, delete `maven-flow.sh` and let flow recreate it
    49→
    50→---
    51→
    52→When you execute `/flow start` or `/flow continue`:
    53→
    54→## EXACT EXECUTION INSTRUCTIONS (READ CAREFULLY):
    55→
    56→**You MUST invoke specialist agents by using natural language to describe the agent and task. Claude Code will automatically delegate to the appropriate agent based on the agent's description field. Each agent runs in its own isolated context window.**
    57→
    58→### For each story, execute each mavenStep by invoking the appropriate agent:
    59→
    60→**Step 1, 2, 7, 9 (Development):**
    61→```
    62→Use the development-agent to work on Step [N] of Maven Workflow for story: [US-XXX - Story title]
    63→
    64→PRD: docs/prd-[feature].json
    65→MCPs to use for this step: [from mcpTools.mcpTools.step[N]]
    66→
    67→## Your Task (Step [N]):
    68→[Detailed step requirements from PRD acceptance criteria]
    69→
    70→## Quality Standards (ZERO TOLERANCE):
    71→- No 'any' types - use proper TypeScript
    72→- No gradients - use solid professional colors
    73→- No relative imports - use @/ aliases
    74→- Components < 300 lines
    75→
    76→When complete, output: [STEP_COMPLETE]
    77→```
    78→
    79→**Step 3, 4, 6 (Refactor):**
    80→```
    81→Use the refactor-agent to work on Step [N] of Maven Workflow for story: [US-XXX - Story title]
    82→[Same prompt structure as above]
    83→```
    84→
    85→**Step 5 (Quality):**
    86→```
    87→Use the quality-agent to work on Step [N] of Maven Workflow for story: [US-XXX - Story title]
    88→[Same prompt structure as above]
    89→```
    90→
    91→**Step 8, 10 (Security):**
    92→```
    93→Use the security-agent to work on Step [N] of Maven Workflow for story: [US-XXX - Story title]
    94→[Same prompt structure as above]
    95→```
    96→
    97→**Step 11 (Design):**
    98→```
    99→Use the design-agent to work on Step [N] of Maven Workflow for story: [US-XXX - Story title]
   100→[Same prompt structure as above]
   101→```
   102→
   103→### Wait for agent completion before proceeding to next step
   104→
   105→### After all steps complete:
   106→1. Run: `pnpm run typecheck` (or `pnpm tsc`)
   107→2. Update PRD: Set `passes: true` for the story
   108→3. Commit: `git add . && git commit -m "feat: [US-XXX] [title]"`
   109→4. Output: `<STORY_COMPLETE>`
   110→
   111→### Then move to next incomplete story
   112→
   113→**DO NOT STOP. Continue automatically until ALL stories complete.**
   114→
   115→---
   116→
   117→Now continue with the standard flow:
   118→   - Wait for agent to complete before spawning next
   119→   - Continue until all mavenSteps are done
   120→5. Run quality checks, commit, update PRD
   121→6. **Repeat automatically** for next story
   122→7. Continue until ALL PRDs have ALL stories passing
   123→8. Do NOT wait for user input between stories
   124→9. Do NOT stop after one story - keep going until ALL are complete
   125→
   126→**Example:**
   127→```
   128→/flow start 15
   129→```
   130→
   131→**How it works:**
   132→1. Scans for all `docs/prd-*.json` files
   133→2. For each PRD, checks if all stories have `passes: true`
   134→3. Finds the first PRD with incomplete stories
   135→4. For each incomplete story (in priority order):
   136→
   137→   **MEMORY LOADING PHASE:**
   138→
   139→   **CRITICAL: Before spawning any agents, you MUST load memory context.**
   140→
   141→   **Step 1: Read PRD's relatedPRDs array**
   142→   ```bash
   143→   # Extract relatedPRDs from the PRD JSON
   144→   cat docs/prd-[feature].json | jq '.relatedPRDs'
   145→   ```
   146→
   147→   **Step 2: Load consolidated memory from each related PRD (if any)**
   148→
   149→   For each related PRD in the array:
   150→   1. **Find the consolidated memory file:**

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
