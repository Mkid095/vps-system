     1â†’---
     2â†’description: Run Maven Flow - autonomous AI development with PRD-driven iteration and 10-step workflow
     3â†’argument-hint: start [max-iterations] | status | continue [prd-name] | reset [prd-name] | test [prd-name] | consolidate [prd-name] | help
     4â†’---
     5â†’
     6â†’# Maven Flow
     7â†’
     8â†’Autonomous AI development flow that implements PRD stories using the Maven 10-Step Workflow. Supports multiple feature PRDs with automatic story tracking and completion.
     9â†’
    10â†’**Multi-PRD Architecture:** Each feature has its own `docs/prd-[feature-name].json` file. The flow automatically scans for incomplete PRDs and processes them in order.
    11â†’
    12â†’## Commands
    13â†’
    14â†’### Start a new flow
    15â†’```
    16â†’/flow start [max-iterations]
    17â†’```
    18â†’
    19â†’**CRITICAL: This command runs AUTOMATICALLY until ALL stories complete**
    20â†’
    21â†’**Architecture:** The `/flow` command (running in main Claude context) coordinates ALL specialist agent spawning directly. Subagents are NOT used for coordination since they cannot spawn other subagents.
    22â†’
    23â†’---
    24â†’
    25â†’## Prerequisites Check
    26â†’
    27â†’Before starting, the command validates:
    28â†’
    29â†’1. **`docs/` directory exists**
    30â†’   - If missing: `âŒ Error: No docs/ directory found.`
    31â†’   - Fix: Create the directory: `mkdir docs`
    32â†’
    33â†’2. **PRD files exist** (`docs/prd-*.json`)
    34â†’   - If missing: `âŒ Error: No PRD files found in docs/.`
    35â†’   - Fix: Create a PRD first using the `flow-prd` skill:
    36â†’     ```
    37â†’     Tell me you want to create a PRD for [feature]
    38â†’     Example: "Create a PRD for a user authentication feature"
    39â†’     ```
    40â†’
    41â†’3. **At least one incomplete story**
    42â†’   - If all PRDs complete: `âœ… All PRDs complete! No work to do.`
    43â†’   - Fix: Create a new PRD or add stories to existing PRD
    44â†’
    45â†’4. **Maven Flow wrapper script** (optional, for local execution)
    46â†’   - The flow can create `maven-flow.sh` locally for direct execution
    47â†’   - This wrapper is created automatically when needed
    48â†’   - If you encounter syntax errors, delete `maven-flow.sh` and let flow recreate it
    49â†’
    50â†’---
    51â†’
    52â†’When you execute `/flow start` or `/flow continue`:
    53â†’
    54â†’## EXACT EXECUTION INSTRUCTIONS (READ CAREFULLY):
    55â†’
    56â†’**You MUST invoke specialist agents by using natural language to describe the agent and task. Claude Code will automatically delegate to the appropriate agent based on the agent's description field. Each agent runs in its own isolated context window.**
    57â†’
    58â†’### For each story, execute each mavenStep by invoking the appropriate agent:
    59â†’
    60â†’**Step 1, 2, 7, 9 (Development):**
    61â†’```
    62â†’Use the development-agent to work on Step [N] of Maven Workflow for story: [US-XXX - Story title]
    63â†’
    64â†’PRD: docs/prd-[feature].json
    65â†’MCPs to use for this step: [from mcpTools.mcpTools.step[N]]
    66â†’
    67â†’## Your Task (Step [N]):
    68â†’[Detailed step requirements from PRD acceptance criteria]
    69â†’
    70â†’## Quality Standards (ZERO TOLERANCE):
    71â†’- No 'any' types - use proper TypeScript
    72â†’- No gradients - use solid professional colors
    73â†’- No relative imports - use @/ aliases
    74â†’- Components < 300 lines
    75â†’
    76â†’When complete, output: [STEP_COMPLETE]
    77â†’```
    78â†’
    79â†’**Step 3, 4, 6 (Refactor):**
    80â†’```
    81â†’Use the refactor-agent to work on Step [N] of Maven Workflow for story: [US-XXX - Story title]
    82â†’[Same prompt structure as above]
    83â†’```
    84â†’
    85â†’**Step 5 (Quality):**
    86â†’```
    87â†’Use the quality-agent to work on Step [N] of Maven Workflow for story: [US-XXX - Story title]
    88â†’[Same prompt structure as above]
    89â†’```
    90â†’
    91â†’**Step 8, 10 (Security):**
    92â†’```
    93â†’Use the security-agent to work on Step [N] of Maven Workflow for story: [US-XXX - Story title]
    94â†’[Same prompt structure as above]
    95â†’```
    96â†’
    97â†’**Step 11 (Design):**
    98â†’```
    99â†’Use the design-agent to work on Step [N] of Maven Workflow for story: [US-XXX - Story title]
   100â†’[Same prompt structure as above]
   101â†’```
   102â†’
   103â†’### Wait for agent completion before proceeding to next step
   104â†’
   105â†’### After all steps complete:
   106â†’1. Run: `pnpm run typecheck` (or `pnpm tsc`)
   107â†’2. Update PRD: Set `passes: true` for the story
   108â†’3. Commit: `git add . && git commit -m "feat: [US-XXX] [title]"`
   109â†’4. Output: `<STORY_COMPLETE>`
   110â†’
   111â†’### Then move to next incomplete story
   112â†’
   113â†’**DO NOT STOP. Continue automatically until ALL stories complete.**
   114â†’
   115â†’---
   116â†’
   117â†’Now continue with the standard flow:
   118â†’   - Wait for agent to complete before spawning next
   119â†’   - Continue until all mavenSteps are done
   120â†’5. Run quality checks, commit, update PRD
   121â†’6. **Repeat automatically** for next story
   122â†’7. Continue until ALL PRDs have ALL stories passing
   123â†’8. Do NOT wait for user input between stories
   124â†’9. Do NOT stop after one story - keep going until ALL are complete
   125â†’
   126â†’**Example:**
   127â†’```
   128â†’/flow start 15
   129â†’```
   130â†’
   131â†’**How it works:**
   132â†’1. Scans for all `docs/prd-*.json` files
   133â†’2. For each PRD, checks if all stories have `passes: true`
   134â†’3. Finds the first PRD with incomplete stories
   135â†’4. For each incomplete story (in priority order):
   136â†’
   137â†’   **MEMORY LOADING PHASE:**
   138â†’
   139â†’   **CRITICAL: Before spawning any agents, you MUST load memory context.**
   140â†’
   141â†’   **Step 1: Read PRD's relatedPRDs array**
   142â†’   ```bash
   143â†’   # Extract relatedPRDs from the PRD JSON
   144â†’   cat docs/prd-[feature].json | jq '.relatedPRDs'
   145â†’   ```
   146â†’
   147â†’   **Step 2: Load consolidated memory from each related PRD (if any)**
   148â†’
   149â†’   For each related PRD in the array:
   150â†’   1. **Find the consolidated memory file:**
   151â†’      ```bash
   152â†’      # Related PRD: docs/prd-auth.json
   153â†’      # Load: docs/consolidated-auth.txt
   154â†’      ```
   155â†’   2. **Read and extract relevant sections:**
   156â†’      ```bash
   157â†’      cat docs/consolidated-[feature].txt
   158â†’      ```
   159â†’   3. **Pre-analyze and summarize** (~3-5K tokens per related PRD):
   160â†’      - Architecture decisions (tech stack, structure)
   161â†’      - Integration patterns (authentication, database, API)
   162â†’      - Public interfaces (endpoints, components)
   163â†’      - Key lessons learned
   164â†’
   165â†’   **Build consolidated memory summary:**
   166â†’   ```
   167â†’   RELATED_PRD_CONTEXT = {
   168â†’     prd-auth.json: {
   169â†’       architecture: [tech stack, structure],
   170â†’       integration: [auth patterns, API endpoints],
   171â†’       lessons: [key learnings]
   172â†’     },
   173â†’     prd-products.json: {
   174â†’       architecture: [data models],
   175â†’       integration: [product API endpoints],
   176â†’       lessons: [database patterns]
   177â†’     }
   178â†’   }
   179â†’   ```
   180â†’
   181â†’   **Step 3: Load previous story memories from same PRD**
   182â†’
   183â†’   Execute:
   184â†’   ```bash
   185â†’   find docs/[feature]/story-*.txt -type f | sort
   186â†’   ```
   187â†’
   188â†’   For each story memory file (~10K tokens total):
   189â†’   1. **Read the story memory file**
   190â†’   2. **Extract:**
   191â†’      - What was implemented (files, components, functions)
   192â†’      - Key decisions made
   193â†’      - Challenges resolved
   194â†’      - Integration points
   195â†’      - Lessons learned
   196â†’
   197â†’   **Build story memory summary:**
   198â†’   ```
   199â†’   PREVIOUS_STORIES_CONTEXT = {
   200â†’     "US-001": {
   201â†’       implemented: [database schema, API endpoints],
   202â†’       decisions: [used Supabase MCP for direct DB access],
   203â†’       integration: [connected to auth feature]
   204â†’     },
   205â†’     "US-002": {
   206â†’       implemented: [UI components, forms],
   207â†’       decisions: [used centralized Form component],
   208â†’       lessons: [test with real data, not mocks]
   209â†’     }
   210â†’   }
   211â†’   ```
   212â†’
   213â†’   **Step 4: Build story session with proper context structure**
   214â†’
   215â†’   When spawning each agent, include:
   216â†’
   217â†’   ```
   218â†’   ## CONTEXT FOR CURRENT STORY
   219â†’
   220â†’   ### From Related PRDs:
   221â†’   - [prd-auth.json]: Authentication uses Supabase Auth with RLS
   222â†’   - [prd-products.json]: Product data accessed via /api/products/*
   223â†’
   224â†’   ### From Previous Stories:
   225â†’   - [US-001]: Database schema uses 'status' enum column
   226â†’   - [US-002]: UI components centralized in @shared/ui
   227â†’
   228â†’   ### Current Story:
   229â†’   - Story: US-003
   230â†’   - Task: [story description]
   231â†’   - Acceptance Criteria: [from PRD]
   232â†’   ```
   233â†’
   234â†’   **Step 5: Inject context into agent prompts**
   235â†’
   236â†’   For each mavenStep, when spawning the agent:
   237â†’   1. **Include PRD JSON** (story description, acceptance criteria)
   238â†’   2. **Include relatedPRDs context** (architecture, integration patterns)
   239â†’   3. **Include previous stories context** (decisions, patterns)
   240â†’   4. **Specify MCPs to use** (from mcpTools.step[N])
   241â†’
   242â†’   **Example agent prompt with context:**
   243â†’   ```
   244â†’   Use the development-agent to work on Step 1 of Maven Workflow for story: US-003 - Add task filtering
   245â†’
   246â†’   You are working on Step 1 of Maven Workflow for story: US-003 - Add task filtering
   247â†’
   248â†’   PRD: docs/prd-task-management.json
   249â†’   MCPs to use for this step: supabase
   250â†’
   251â†’   ## CONTEXT FROM RELATED FEATURES:
   252â†’
   253â†’   ### Authentication (prd-auth.json):
   254â†’   - Auth provider: Supabase Auth
   255â†’   - User ID accessed via: auth.getUser()
   256â†’   - RLS policies filter by user_id automatically
   257â†’
   258â†’   ### Products (prd-products.json):
   259â†’   - Product API: /api/products (GET, POST, PUT, DELETE)
   260â†’   - Data model: { id, name, price, status }
   261â†’
   262â†’   ## CONTEXT FROM PREVIOUS STORIES:
   263â†’
   264â†’   ### US-001: Database schema
   265â†’   - Table: tasks (id, title, status, user_id, created_at)
   266â†’   - Status enum: 'pending', 'in_progress', 'completed'
   267â†’   - Decision: Used Supabase MCP for direct schema creation
   268â†’
   269â†’   ### US-002: UI components
   270â†’   - Form component: @shared/ui/Form
   271â†’   - Input component: @shared/ui/Input
   272â†’   - Decision: Centralize reusable UI components
   273â†’
   274â†’   ## YOUR TASK (Step 1 - Foundation):
   275â†’
   276â†’   [Detailed step requirements from PRD acceptance criteria]
   277â†’
   278â†’   ## QUALITY STANDARDS (ZERO TOLERANCE):
   279â†’   - No 'any' types - use proper TypeScript
   280â†’   - No gradients - use solid professional colors
   281â†’   - No relative imports - use @/ aliases
   282â†’   - Components < 300 lines
   283â†’
   284â†’   When complete, output: [STEP_COMPLETE]
   285â†’   ```
   286â†’
   287â†’   **âš ï¸ CRITICAL:** Do NOT skip memory loading. Agents need context from:
   288â†’   - Related PRDs (how to integrate)
   289â†’   - Previous stories (patterns to follow)
   290â†’   - Architecture decisions (what already exists)
   291â†’
   292â†’   **IMPLEMENTATION PHASE:**
   293â†’   - Read story's mavenSteps array
   294â†’   - Read story's mcpTools (if specified for each step)
   295â†’   - **Spawn specialist agents using natural language:**
   296â†’     - Step 1, 2, 7, 9 â†’ "Use the development-agent to work on..."
   297â†’     - Step 3, 4, 6 â†’ "Use the refactor-agent to work on..."
   298â†’     - Step 5 â†’ "Use the quality-agent to work on..."
   299â†’     - Step 8, 10 â†’ "Use the security-agent to work on..."
   300â†’     - Step 11 â†’ "Use the design-agent to work on..." [optional, for mobile apps]
   301â†’   - **Tell agent which MCPs to use with EXPLICIT INSTRUCTIONS at the start of prompt:**
   302â†’     ```
   303â†’     *** CRITICAL: MCP TOOLS INSTRUCTION ***
   304â†’     You MUST use the Supabase MCP tools for ALL database operations.
   305â†’     DO NOT read migration files or create scripts.
   306â†’     SCAN FIRST - Use MCP to list/check what exists in the database BEFORE making any changes.
   307â†’     Query the database DIRECTLY using Supabase MCP tools.
   308â†’
   309â†’     Story: US-POS-001, Step 1
   310â†’     MCPs: supabase
   311â†’     ```
   312â†’   - Wait for each agent to complete
   313â†’   - Run quality checks (typecheck, lint)
   314â†’
   315â†’   **MEMORY CREATION PHASE (MANDATORY - DO NOT SKIP!):**
   316â†’
   317â†’   This phase is CRITICAL for the memory system. You MUST execute it for EVERY completed story.
   318â†’
   319â†’   **Invoke the story memory creation command:**
   320â†’
   321â†’   ```
   322â†’   /create-story-memory docs/prd-[feature].json US-[XXX]
   323â†’   ```
   324â†’
   325â†’   This command will:
   326â†’   1. Extract story details from the PRD
   327â†’   2. Analyze the git diff to understand what was implemented
   328â†’   3. Generate a comprehensive story memory file at:
   329â†’      `docs/[feature]/story-US-[###]-[title].txt`
   330â†’   4. Include:
   331â†’      - What was implemented (specific files, functions, components)
   332â†’      - Key decisions made (architecture choices, design patterns)
   333â†’      - Technical challenges encountered and how they were resolved
   334â†’      - Integration points with other features
   335â†’      - Lessons learned for future work
   336â†’
   337â†’   **After the command completes, verify the memory file was created:**
   338â†’   ```bash
   339â†’   test -f docs/[feature]/story-US-[###]-*.txt && echo "âœ“ Memory created" || echo "âœ— Memory missing"
   340â†’   ```
   341â†’
   342â†’   **Then update PRD JSON and commit:**
   343â†’   1. Update PRD JSON: Set `passes: true` for the completed story
   344â†’   2. Commit changes with proper format: `feat: [story-id] [story-title]`
   345â†’   3. Output the `<STORY_COMPLETE>` signal to indicate completion
   346â†’
   347â†’   **âš ï¸ WARNING:** Do NOT skip or defer memory creation. The memory system depends on these files being created after each story.
   348â†’
   349â†’5. Move to next incomplete story
   350â†’
   351â†’6. **CONSOLIDATION PHASE (when ALL stories in PRD complete):**
   352â†’
   353â†’   When ALL stories in the PRD have `passes: true`, you MUST consolidate all story memories.
   354â†’
   355â†’   **Invoke the consolidation command:**
   356â†’
   357â†’   ```
   358â†’   /consolidate-memory docs/prd-[feature].json
   359â†’   ```
   360â†’
   361â†’   This command will:
   362â†’   1. **Read all story memory files** from `docs/[feature]/story-US-*.txt`
   363â†’   2. **Update the consolidated memory file:** `docs/consolidated-[feature].txt`
   364â†’      - Read existing content first
   365â†’      - Consolidate all story memories into comprehensive format
   366â†’      - Update totals: `totalStories` and `completedStories` to actual counts
   367â†’      - Set `status: completed`
   368â†’      - Update `consolidatedDate` to current date
   369â†’   3. **Target ~30-50K tokens** - Summarize while preserving critical information
   370â†’   4. **Focus on:** Patterns, decisions, interfaces, integration points, lessons learned
   371â†’   5. **Output:** `<ALL_COMPLETE>` signal
   372â†’
   373â†’   **After the command completes, verify the consolidated memory was updated:**
   374â†’   ```bash
   375â†’   grep -q "status: completed" docs/consolidated-[feature].txt && echo "âœ“ Consolidated" || echo "âœ— Consolidation failed"
   376â†’   ```
   377â†’
   378â†’   **âš ï¸ IMPORTANT:** This UPDATES the existing `docs/consolidated-[feature].txt` file that was created by flow-prd. Do NOT overwrite - UPDATE it by reading first, then updating the fields.
   379â†’
   380â†’7. Continue to next incomplete PRD until all PRDs complete
   381â†’8. Default: 10 iterations (stories) unless specified
   382â†’
   383â†’### Check status
   384â†’```
   385â†’/flow status
   386â†’```
   387â†’- Lists all PRD files in `docs/`
   388â†’- Shows completion status for each PRD
   389â†’- Displays stories (completed/pending) for each PRD
   390â†’- Shows progress summary from each `docs/progress-[feature-name].txt`
   391â†’
   392â†’**Example output:**
   393â†’```
   394â†’Maven Flow Status: 3 PRD files found
   395â†’
   396â†’prd-task-priority.json (3/5 complete)
   397â†’  âœ“ US-001: Add priority field to database
   398â†’  âœ“ US-002: Display priority indicator
   399â†’  âœ“ US-003: Add priority selector
   400â†’  â—‹ US-004: Filter tasks by priority (priority: 4)
   401â†’  â—‹ US-005: Add priority sorting (priority: 5)
   402â†’
   403â†’prd-user-auth.json (0/4 complete)
   404â†’  â—‹ US-001: Firebase authentication setup
   405â†’  â—‹ US-002: Supabase profile storage
   406â†’  â—‹ US-003: Login form UI
   407â†’  â—‹ US-004: Password reset flow
   408â†’
   409â†’prd-notifications.json (4/4 complete) âœ…
   410â†’  âœ“ All stories complete
   411â†’
   412â†’Current focus: prd-task-priority.json
   413â†’
   414â†’Recent progress:
   415â†’  [2025-01-10] prd-task-priority.json - US-003 Added priority dropdown
   416â†’  Agents: refactor-agent, quality-agent
   417â†’```
   418â†’
   419â†’### Continue flow
   420â†’```
   421â†’/flow continue [max-iterations]
   422â†’/flow continue [prd-name] [max-iterations]
   423â†’```
   424â†’- Resumes from last iteration
   425â†’- Continues with current PRD (default) or specified PRD
   426â†’- Continues with remaining stories where `passes: false`
   427â†’- Useful when flow was interrupted
   428â†’
   429â†’**Examples:**
   430â†’```
   431â†’/flow continue          # Continue with current PRD
   432â†’/flow continue 5        # Continue with 5 more iterations
   433â†’/flow continue task-priority  # Continue specific PRD
   434â†’```
   435â†’
   436â†’### Reset flow
   437â†’```
   438â†’/flow reset
   439â†’/flow reset [prd-name]
   440â†’```
   441â†’- Archives specified PRD run to `archive/YYYY-MM-DD-[feature-name]/`
   442â†’- Resets `docs/prd-[feature-name].json` and `docs/progress-[feature-name].txt`
   443â†’- If no PRD specified, prompts to select which PRD to reset
   444â†’- Prompts for confirmation before archiving
   445â†’
   446â†’**Examples:**
   447â†’```
   448â†’/flow reset              # Prompts to select PRD
   449â†’/flow reset task-priority  # Reset specific PRD
   450â†’```
   451â†’
   452â†’### Test application
   453â†’```
   454â†’/flow test [prd-name]
   455â†’```
   456â†’- Runs comprehensive testing of all implemented features
   457â†’- Uses testing-agent with chrome-devtools MCP
   458â†’- Tests all completed stories (where `passes: true`)
   459â†’- Creates error log at `docs/errors-[feature-name].md`
   460â†’- Uses standard test user: `revccnt@gmail.com` / `Elishiba!90`
   461â†’
   462â†’**Process:**
   463â†’1. Reads PRD to find completed stories
   464â†’2. Starts dev server: `pnpm dev`
   465â†’3. Opens application using chrome-devtools MCP
   466â†’4. Tests user signup/login
   467â†’5. Tests each completed feature's acceptance criteria
   468â†’6. Checks console for errors
   469â†’7. Logs all errors found with details
   470â†’8. Creates error log markdown file
   471â†’
   472â†’**What gets tested:**
   473â†’- User authentication (signup, login, logout)
   474â†’- All completed stories' acceptance criteria
   475â†’- Console errors (JavaScript, network, API)
   476â†’- UI functionality
   477â†’- Navigation between pages
   478â†’- Form submissions
   479â†’- Data display
   480â†’
   481â†’**Error log format:** `docs/errors-[feature-name].md`
   482â†’- Each error with story ID, severity, error message
   483â†’- Steps to reproduce
   484â†’- Expected vs actual behavior
   485â†’- Related file references
   486â†’- Suggested fixes
   487â†’
   488â†’**Examples:**
   489â†’```bash
   490â†’/flow test                    # Test current PRD (auto-detects)
   491â†’/flow test authentication     # Test authentication PRD
   492â†’/flow test task-priority      # Test task-priority PRD
   493â†’```
   494â†’
   495â†’**After testing:**
   496â†’- Review error log: `docs/errors-[feature-name].md`
   497â†’- Run `/flow consolidate [prd-name]` to fix errors
   498â†’
   499â†’---
   500â†’
   501â†’### Consolidate and fix errors
   502â†’```
   503â†’/flow consolidate [prd-name]
   504â†’```
   505â†’- Reads error log from `docs/errors-[feature-name].md`
   506â†’- Identifies which stories/steps have errors
   507â†’- Re-runs ONLY the affected steps (not entire stories)
   508â†’- Fixes specific errors found during testing
   509â†’- Does NOT reimplement completed features
   510â†’
   511â†’**Process:**
   512â†’1. Read error log: `docs/errors-[feature-name].md`
   513â†’2. Parse each error to identify:
   514â†’   - Which story (US-XXX) has the error
   515â†’   - Which step/mavenStep needs to be re-run
   516â†’   - What the specific error is
   517â†’3. For each error:
   518â†’   - Spawn appropriate agent (development, quality, security, etc.)
   519â†’   - Tell agent exactly what error to fix
   520â†’   - Wait for fix to be applied
   521â†’4. Re-test ONLY the fixed item
   522â†’5. Mark error as resolved in log
   523â†’6. Continue until all errors fixed
   524â†’
   525â†’**What it does NOT do:**
   526â†’- Does NOT run full mavenSteps again
   527â†’- Does NOT re-implement completed features
   528â†’- Does NOT touch working code
   529â†’- Only fixes the specific errors identified
   530â†’
   531â†’**Examples:**
   532â†’```bash
   533â†’/flow consolidate            # Consolidate current PRD
   534â†’/flow consolidate auth       # Consolidate authentication PRD
   535â†’```
   536â†’
   537â†’**Output:**
   538â†’- Shows which errors are being fixed
   539â†’- Shows which agent is handling each fix
   540â†’- Commits each fix separately
   541â†’- Updates error log as fixes are applied
   542â†’
   543â†’---
   544â†’
   545â†’### Help
   546â†’```
   547â†’/flow help
   548â†’```
   549â†’- Displays comprehensive help information
   550â†’- Shows detailed command reference, workflow, and troubleshooting
   551â†’
   552â†’---
   553â†’
   554â†’# Comprehensive Guide
   555â†’
   556â†’## Table of Contents
   557â†’1. [Quick Start](#quick-start)
   558â†’2. [Command Reference](#command-reference)
   559â†’3. [Maven 10-Step Workflow](#maven-10-step-workflow)
   560â†’4. [Specialist Agents](#specialist-agents)
   561â†’5. [MCP Tool Assignment](#mcp-tool-assignment)
   562â†’6. [Quality Standards](#quality-standards)
   563â†’7. [Browser Testing](#browser-testing)
   564â†’8. [Required MCPs](#required-mcps)
   565â†’9. [Testing & Consolidation](#testing--consolidation)
   566â†’10. [Mobile Development](#mobile-development)
   567â†’11. [Common Workflows](#common-workflows)
   568â†’12. [Troubleshooting](#troubleshooting)
   569â†’
   570â†’---
   571â†’
   572â†’## Quick Start
   573â†’
   574â†’### For New Users
   575â†’
   576â†’**Step 1: Create your first PRD**
   577â†’```
   578â†’Tell me you want to create a PRD for [feature description]
   579â†’Example: "Create a PRD for a user authentication system"
   580â†’```
   581â†’
   582â†’**Step 2: Convert to JSON format**
   583â†’```
   584â†’/flow-convert
   585â†’```
   586â†’This creates `docs/prd-[feature-name].json`
   587â†’
   588â†’**Step 3: Start autonomous development**
   589â†’```
   590â†’/flow start
   591â†’```
   592â†’
   593â†’The flow will:
   594â†’- Scan for all incomplete PRDs
   595â†’- Process each story automatically
   596â†’- Spawn specialist agents for each step
   597â†’- Commit changes with proper format
   598â†’- Continue until ALL stories are complete
   599â†’
   600â†’**Step 4: Monitor progress**
   601â†’```
   602â†’/flow status
   603â†’```
   604â†’
   605â†’---
   606â†’
   607â†’## Command Reference
   608â†’
   609â†’### `/flow start [max-iterations]`
   610â†’Starts autonomous flow execution.
   611â†’
   612â†’**Parameters:**
   613â†’- `max-iterations` (optional): Number of stories to process (default: 10)
   614â†’
   615â†’**Behavior:**
   616â†’- Scans for all PRD files in `docs/`
   617â†’- Identifies incomplete stories (`passes: false`)
   618â†’- Processes stories in priority order
   619â†’- Spawns specialist agents for each mavenStep
   620â†’- Runs quality checks after each story
   621â†’- Commits changes with standardized format
   622â†’- Updates PRD to mark story complete
   623â†’- Continues to next story automatically
   624â†’
   625â†’**Examples:**
   626â†’```bash
   627â†’/flow start          # Process up to 10 stories (default)
   628â†’/flow start 20       # Process up to 20 stories
   629â†’/flow start 1        # Process exactly 1 story then stop
   630â†’```
   631â†’
   632â†’**What happens during execution:**
   633â†’1. Validates prerequisites (docs/, PRD files, incomplete stories)
   634â†’2. Lists all PRD files found
   635â†’3. Shows which PRD will be processed first
   636â†’4. For each incomplete story:
   637â†’   - Displays story ID and title
   638â†’   - Shows mavenSteps to be executed
   639â†’   - Shows MCPs assigned for each step
   640â†’   - Spawns agents one at a time
   641â†’   - Waits for each agent to complete
   642â†’   - Runs typecheck and lint
   643â†’   - Creates git commit
   644â†’   - Marks story as complete in PRD
   645â†’5. Moves to next story automatically
   646â†’6. Continues until max iterations or all PRDs complete
   647â†’
   648â†’### `/flow status`
   649â†’Shows current status of all PRDs.
   650â†’
   651â†’**Output includes:**
   652â†’- Total PRD files found
   653â†’- Completion status for each PRD
   654â†’- List of all stories with completion status
   655â†’- Recent progress from progress files
   656â†’
   657â†’**Example output:**
   658â†’```
   659â†’Maven Flow Status: 3 PRD files found
   660â†’
   661â†’prd-task-priority.json (3/5 complete)
   662â†’  âœ“ US-001: Add priority field to database
   663â†’  âœ“ US-002: Display priority indicator
   664â†’  âœ“ US-003: Add priority selector
   665â†’  â—‹ US-004: Filter tasks by priority (priority: 4)
   666â†’  â—‹ US-005: Add priority sorting (priority: 5)
   667â†’
   668â†’prd-user-auth.json (0/4 complete)
   669â†’  â—‹ US-001: Firebase authentication setup
   670â†’  â—‹ US-002: Supabase profile storage
   671â†’  â—‹ US-003: Login form UI
   672â†’  â—‹ US-004: Password reset flow
   673â†’
   674â†’prd-notifications.json (4/4 complete) âœ…
   675â†’
   676â†’Current focus: prd-task-priority.json
   677â†’
   678â†’Recent progress:
   679â†’  [2025-01-10] prd-task-priority.json - US-003 Added priority dropdown
   680â†’```
   681â†’
   682â†’### `/flow continue [prd-name] [max-iterations]`
   683â†’Resumes flow execution from where it left off.
   684â†’
   685â†’**Parameters:**
   686â†’- `prd-name` (optional): Specific PRD to process (default: current)
   687â†’- `max-iterations` (optional): Number of stories to process
   688â†’
   689â†’**When to use:**
   690â†’- After fixing an error that stopped the flow
   691â†’- After manually editing PRD or code
   692â†’- To continue with a specific PRD
   693â†’- To process more stories than originally planned
   694â†’
   695â†’**Examples:**
   696â†’```bash
   697â†’/flow continue           # Continue with current PRD
   698â†’/flow continue 5         # Process 5 more stories
   699â†’/flow continue auth 10   # Process auth PRD for 10 stories
   700â†’```
   701â†’
   702â†’### `/flow reset [prd-name]`
   703â†’Archives current PRD run and resets for fresh start.
   704â†’
   705â†’**Parameters:**
   706â†’- `prd-name` (optional): Specific PRD to reset (prompts if omitted)
   707â†’
   708â†’**Behavior:**
   709â†’- Creates archive: `archive/YYYY-MM-DD-[feature-name]/`
   710â†’- Moves current PRD and progress file to archive
   711â†’- Resets all stories to `passes: false`
   712â†’- Creates fresh PRD and progress files
   713â†’- Prompts for confirmation before archiving
   714â†’
   715â†’**Examples:**
   716â†’```bash
   717â†’/flow reset           # Prompts to select PRD
   718â†’/flow reset auth      # Reset auth PRD specifically
   719â†’```
   720â†’
   721â†’**When to use:**
   722â†’- PRD has fundamental issues
   723â†’- Want to start over with different approach
   724â†’- Need to archive current progress before major changes
   725â†’
   726â†’---
   727â†’
   728â†’## Maven 10-Step Workflow
   729â†’
   730â†’Each story is implemented through specific steps, each handled by a specialist agent.
   731â†’
   732â†’| Step | Agent | Description | Duration |
   733â†’|------|-------|-------------|----------|
   734â†’| 1 | development-agent | Foundation - Import UI or create from scratch | ~5-10 min |
   735â†’| 2 | development-agent | Package Manager - Convert npm â†’ pnpm | ~2-5 min |
   736â†’| 3 | refactor-agent | Feature Structure - Restructure folders | ~5-10 min |
   737â†’| 4 | refactor-agent | Modularization - Split large components | ~5-15 min |
   738â†’| 5 | quality-agent | Type Safety - Remove 'any' types, add @ aliases | ~5-10 min |
   739â†’| 6 | refactor-agent | UI Centralization - Move to @shared/ui | ~5-10 min |
   740â†’| 7 | development-agent | Data Layer - Backend setup, Supabase integration | ~10-20 min |
   741â†’| 8 | security-agent | Auth Integration - Firebase + Supabase auth | ~10-15 min |
   742â†’| 9 | development-agent | MCP Integration - Connect MCP tools | ~5-10 min |
   743â†’| 10 | security-agent | Security & Error Handling | ~10-15 min |
   744â†’| 11 | design-agent | Mobile Design - Professional UI (optional) | ~15-20 min |
   745â†’
   746â†’**Total typical story duration:** 1-2 hours depending on complexity
   747â†’
   748â†’**Step dependencies:**
   749â†’- Steps must be completed in order
   750â†’- Each step builds on previous steps
   751â†’- Quality checks run after all steps complete
   752â†’
   753â†’---
   754â†’
   755â†’## Specialist Agents
   756â†’
   757â†’### development-agent (ğŸŸ¢ Green)
   758â†’**Use for:** Steps 1, 2, 7, 9
   759â†’
   760â†’**Responsibilities:**
   761â†’- Import UI with mock data or create from scratch
   762â†’- Convert package manager (npm â†’ pnpm)
   763â†’- Set up data layer (Supabase, API clients)
   764â†’- Integrate MCP tools
   765â†’- Set up project foundation
   766â†’
   767â†’**Key actions:**
   768â†’- Creates base components with mock data
   769â†’- Installs and configures Supabase client
   770â†’- Sets up API middleware
   771â†’- Connects MCP tools (web-search, web-reader, browser)
   772â†’- Commits with prefix `feat:`
   773â†’
   774â†’### refactor-agent (ğŸ”µ Blue)
   775â†’**Use for:** Steps 3, 4, 6
   776â†’
   777â†’**Responsibilities:**
   778â†’- Restructure to feature-based architecture
   779â†’- Modularize large components
   780â†’- Centralize UI components to @shared/ui
   781â†’
   782â†’**Key actions:**
   783â†’- Moves code to feature-based folders
   784â†’- Splits components >300 lines
   785â†’- Extracts reusable UI components
   786â†’- Enforces architecture rules
   787â†’- Commits with prefix `refactor:`
   788â†’
   789â†’### quality-agent (ğŸŸ£ Purple)
   790â†’**Use for:** Step 5
   791â†’
   792â†’**Responsibilities:**
   793â†’- Type safety enforcement
   794â†’- Import alias verification
   795â†’- Quality standards compliance
   796â†’
   797â†’**Key actions:**
   798â†’- Removes ALL 'any' types (zero tolerance)
   799â†’- Converts relative imports to @ aliases
   800â†’- Verifies component sizes
   801â†’- Blocks on quality violations
   802â†’- Auto-fixes import paths
   803â†’- Commits with prefix `fix:`
   804â†’
   805â†’**BLOCKING Issues:**
   806â†’- 'any' types in code
   807â†’- Gradients in CSS
   808â†’- Emojis in UI components
   809â†’- Relative imports
   810â†’
   811â†’### security-agent (ğŸ”´ Red)
   812â†’**Use for:** Steps 8, 10
   813â†’
   814â†’**Responsibilities:**
   815â†’- Authentication flow implementation
   816â†’- Security vulnerability checks
   817â†’- Error handling setup
   818â†’
   819â†’**Key actions:**
   820â†’- Firebase Auth integration
   821â†’- Supabase Row-Level Security (RLS)
   822â†’- JWT validation
   823â†’- Input sanitization
   824â†’- Error boundary implementation
   825â†’- Commits with prefix `security:`
   826â†’
   827â†’### design-agent (ğŸ©· Pink)
   828â†’**Use for:** Step 11 (optional, mobile apps only)
   829â†’
   830â†’**Responsibilities:**
   831â†’- Professional mobile UI/UX design
   832â†’- Apple design methodology application
   833â†’
   834â†’**Key actions:**
   835â†’- Applies professional visual design
   836â†’- Implements proper navigation patterns
   837â†’- Ensures touch targets (44x44pt minimum)
   838â†’- Validates in Expo preview
   839â†’- Commits with prefix `design:`
   840â†’
   841â†’### testing-agent (ğŸŸ  Orange)
   842â†’**Use for:** `/flow test` command (not part of mavenSteps)
   843â†’
   844â†’**Responsibilities:**
   845â†’- Comprehensive application testing
   846â†’- Error logging and reporting
   847â†’- Browser automation with chrome-devtools MCP
   848â†’
   849â†’**Key actions:**
   850â†’- Opens application using chrome-devtools MCP
   851â†’- Tests all completed stories (where `passes: true`)
   852â†’- Tests signup/login with standard test user
   853â†’- Checks console for errors (logs ALL errors found)
   854â†’- Tests each acceptance criterion
   855â†’- Creates error log at `docs/errors-[feature-name].md`
   856â†’- Reports testing results with error counts and severity
   857â†’
   858â†’**Required MCP:**
   859â†’- chrome-devtools (REQUIRED - cannot test without it)
   860â†’
   861â†’**Test Credentials:**
   862â†’- Email: `revccnt@gmail.com`
   863â†’- Password: `Elishiba!90`
   864â†’
   865â†’**Commit prefix:** `test:` (only commits if making test fixes)
   866â†’
   867â†’---
   868â†’
   869â†’### mobile-app-agent (ğŸ”µ Cyan)
   870â†’**Use for:** Mobile development (React Native + Expo apps)
   871â†’
   872â†’**Responsibilities:**
   873â†’- Mobile screen implementation with Expo Router
   874â†’- Offline-first data management with TanStack Query
   875â†’- Native UI patterns (swipe, pull-to-refresh, bottom sheets)
   876â†’- NativeWind styling (Tailwind for React Native)
   877â†’- Push notifications with Firebase Cloud Messaging
   878â†’- Touch-optimized interactions (44pt minimum)
   879â†’
   880â†’**Key actions:**
   881â†’- Creates mobile screens in `mobile/app/` folder
   882â†’- Implements offline support with AsyncStorage
   883â†’- Uses NativeWind utility classes for styling
   884â†’- Integrates Firebase Cloud Messaging for push notifications
   885â†’- Implements native UI patterns (pull-to-refresh, swipe actions)
   886â†’- Tests with Expo Go or device simulators
   887â†’- Uses same Supabase backend as web app
   888â†’- Commits with prefix `mobile:`
   889â†’
   890â†’**Required MCPs:**
   891â†’- supabase (REQUIRED - shared backend with web)
   892â†’- web-search-prime (Recommended - for mobile best practices)
   893â†’
   894â†’**Mobile Location:**
   895â†’- Works in `mobile/` folder
   896â†’- Mobile PRDs in `mobile/docs/prd-*.json`
   897â†’- Uses Expo Router (file-based routing)
   898â†’- TypeScript with strict mode
   899â†’
   900â†’**Server Management:**
   901â†’- Expo server runs on port 8081
   902â†’- Stop ONLY Expo process, not all Node processes
   903â†’- Use: `kill -9 $(lsof -ti:8081)`
   904â†’
   905â†’**Tech Stack:**
   906â†’- Frontend: React Native + Expo
   907â†’- Navigation: Expo Router
   908â†’- Styling: NativeWind (Tailwind)
   909â†’- State: TanStack Query + Zustand
   910â†’- Auth: Firebase Authentication
   911â†’- Backend: Supabase (shared with web)
   912â†’- Push: Firebase Cloud Messaging
   913â†’- Offline: AsyncStorage with sync
   914â†’
   915â†’
   916â†’## MCP Tool Assignment
   917â†’
   918â†’### What are MCPs?
   919â†’MCPs (Model Context Protocol) extend Claude with external tools like databases, web search, and browser automation.
   920â†’
   921â†’### How MCP Assignment Works
   922â†’
   923â†’**1. PRD specifies MCPs per step:**
   924â†’```json
   925â†’{
   926â†’  "id": "US-001",
   927â†’  "mavenSteps": [1, 7],
   928â†’  "mcpTools": {
   929â†’    "step1": ["supabase"],
   930â†’    "step7": ["supabase", "web-search-prime"]
   931â†’  }
   932â†’}
   933â†’```
   934â†’
   935â†’**2. Flow tells agent which MCPs to use:**
   936â†’```
   937â†’*** CRITICAL: MCP TOOLS INSTRUCTION ***
   938â†’You MUST use the Supabase MCP tools for ALL database operations.
   939â†’SCAN FIRST - Use MCP to list/check what exists in the database BEFORE making changes.
   940â†’Query the database DIRECTLY using Supabase MCP tools.
   941â†’
   942â†’Story: US-001, Step 1
   943â†’MCPs: supabase
   944â†’```
   945â†’
   946â†’**3. Agent uses those MCPs:**
   947â†’- Checks if MCPs are available in their tool set
   948â†’- Uses MCP tools directly to query database, run migrations, etc.
   949â†’- Falls back to standard tools only if MCPs unavailable
   950â†’
   951â†’### Available MCPs
   952â†’
   953â†’| MCP Name | Purpose | Steps Used For |
   954â†’|----------|---------|----------------|
   955â†’| supabase | Database operations | 1, 7, 8, 10 |
   956â†’| web-search-prime | Research, documentation | All steps |
   957â†’| web-reader | Read web content | All steps |
   958â†’| chrome-devtools | Browser testing | Testing phases |
   959â†’| playwright | Browser automation | Testing phases |
   960â†’| vercel | Deployment to Vercel | 9 |
   961â†’| wrangler | Deployment to Cloudflare | 9 |
   962â†’| figma | Design work | 11 |
   963â†’
   964â†’**MCP Usage Rules:**
   965â†’- **SCAN FIRST** - Always list/check what exists before making changes
   966â†’- **Query directly** - Use MCP tools, don't read migration files
   967â†’- **Verify in actual database** - Don't trust type files, verify with MCP
   968â†’- **Fall back gracefully** - Use standard tools if MCP unavailable
   969â†’
   970â†’---
   971â†’
   972â†’## Required Files
   973â†’
   974â†’| File | Purpose |
   975â†’|------|---------|
   976â†’| `docs/prd-[feature-name].json` | Feature PRD with user stories, acceptance criteria, and pass/fail status |
   977â†’| `docs/progress-[feature-name].txt` | Append-only log of learnings and context for each feature |
   978â†’| `AGENTS.md` | Codebase patterns and conventions (auto-updated during flow) |
   979â†’
   980â†’## Maven 10-Step Workflow (Plus Optional Design Step)
   981â†’
   982â†’Each story is implemented using the Maven workflow:
   983â†’
   984â†’| Step | Agent | Color | Description |
   985â†’|------|-------|-------|-------------|
   986â†’| **1** | development-agent | ğŸŸ¢ Green | Import UI with mock data or create from scratch |
   987â†’| **2** | development-agent | ğŸŸ¢ Green | Convert npm â†’ pnpm |
   988â†’| **3** | refactor-agent | ğŸ”µ Blue | Restructure to feature-based folder structure |
   989â†’| **4** | refactor-agent | ğŸ”µ Blue | Modularize components >300 lines |
   990â†’| **5** | quality-agent | ğŸŸ£ Purple | Type safety - no 'any' types, @ aliases |
   991â†’| **6** | refactor-agent | ğŸ”µ Blue | Centralize UI components to @shared/ui |
   992â†’| **7** | development-agent | ğŸŸ¢ Green | Centralized data layer with backend setup |
   993â†’| **8** | security-agent | ğŸ”´ Red | Firebase + Supabase authentication flow |
   994â†’| **9** | development-agent | ğŸŸ¢ Green | MCP integrations (web-search, web-reader, chrome, expo, supabase) |
   995â†’| **10** | security-agent | ğŸ”´ Red | Security and error handling |
   996â†’| **11** | design-agent | ğŸ©· Pink | **Mobile Design** - Professional UI/UX for Expo/React Native (optional) |
   997â†’
   998â†’**Step 11 is optional** and specifically for mobile app (Expo/React Native) projects. It applies Apple's design methodology to transform basic UIs into professional, polished mobile experiences.
   999â†’
  1000â†’## Workflow
  1001â†’
  1002â†’1. **Create PRD** - Use the `flow-prd` skill to generate requirements
  1003â†’2. **Convert to JSON** - Use the `flow-convert` skill to create `docs/prd-[feature-name].json`
  1004â†’3. **Start Flow** - Run `/flow start` to begin autonomous iteration
  1005â†’4. **Monitor Progress** - Use `/flow status` to check all PRDs
  1006â†’5. **Review Results** - Each story is committed separately with descriptive messages
  1007â†’
  1008â†’## How It Works
  1009â†’
  1010â†’### Multi-PRD Processing
  1011â†’
  1012â†’When you run `/flow start`:
  1013â†’
  1014â†’1. **Scan Phase:** The flow scans `docs/` for all `prd-*.json` files
  1015â†’2. **Priority Phase:** For each PRD, checks completion status:
  1016â†’   - Loads JSON and checks if all stories have `passes: true`
  1017â†’   - Identifies PRDs with incomplete stories (`passes: false`)
  1018â†’3. **Selection Phase:** Picks the first incomplete PRD (alphabetically by filename)
  1019â†’4. **Iteration Phase:** Processes that PRD's stories one by one:
  1020â†’   - Reads PRD JSON and picks highest priority story where `passes: false`
  1021â†’   - Reads story's `mavenSteps` array
  1022â†’   - **Spawns specialist agents directly** (one per mavenStep)
  1023â†’   - Waits for each agent to complete
  1024â†’   - Runs quality checks
  1025â†’   - Commits changes
  1026â†’   - Updates PRD to `passes: true`
  1027â†’   - Appends learnings to progress file
  1028â†’5. **Completion Phase:** When PRD is complete (all `passes: true`):
  1029â†’   - Marks PRD as complete
  1030â†’   - Moves to next incomplete PRD
  1031â†’   - Repeats iteration phase
  1032â†’6. **Final Phase:** When all PRDs are complete:
  1033â†’   - Outputs completion summary
  1034â†’
  1035â†’### Maven Step to Agent Mapping
  1036â†’
  1037â†’The `/flow` command maps each step in the story's `mavenSteps` array to the appropriate specialist agent:
  1038â†’
  1039â†’| Maven Step | Agent Type | Task subagent_type | Description |
  1040â†’|------------|------------|-------------------|-------------|
  1041â†’| 1 | Foundation | development-agent | Import UI with mock data or create from scratch |
  1042â†’| 2 | Package Manager | development-agent | Convert npm â†’ pnpm |
  1043â†’| 3 | Feature Structure | refactor-agent | Restructure to feature-based folder structure |
  1044â†’| 4 | Modularization | refactor-agent | Modularize components >300 lines |
  1045â†’| 5 | Type Safety | quality-agent | Type safety - no 'any' types, @ aliases |
  1046â†’| 6 | UI Centralization | refactor-agent | Centralize UI components to @shared/ui |
  1047â†’| 7 | Data Layer | development-agent | Centralized data layer with backend setup |
  1048â†’| 8 | Auth Integration | security-agent | Firebase + Supabase authentication flow |
  1049â†’| 9 | MCP Integration | development-agent | MCP integrations (web-search, web-reader, chrome, expo, supabase) |
  1050â†’| 10 | Security & Error Handling | security-agent | Security and error handling |
  1051â†’| 11 | Mobile Design | design-agent | Professional UI/UX for Expo/React Native (optional) |
  1052â†’
  1053â†’### Story Processing Flow
  1054â†’
  1055â†’For each incomplete story:
  1056â†’
  1057â†’```markdown
  1058â†’## Story: [Story ID] - [Story Title]
  1059â†’
  1060â†’**From PRD:**
  1061â†’- mavenSteps: [1, 3, 5, 7]
  1062â†’- mcpTools: { step1: ["supabase"], step7: ["supabase", "web-search-prime"] }
  1063â†’- Description: [Story description]
  1064â†’- Acceptance Criteria: [List from PRD]
  1065â†’
  1066â†’**Processing:**
  1067â†’
  1068â†’1. [Step 1 - Foundation]
  1069â†’   Spawning development agent...
  1070â†’   Instruction: "Use these MCPs: supabase"
  1071â†’   INSTRUCTION: USE SUPABASE MCP TOOLS to query/verify database directly. DO NOT just read type files.
  1072â†’   â†’ [Waiting for completion]
  1073â†’   â†’ [Agent completed successfully]
  1074â†’
  1075â†’2. [Step 3 - Feature Structure]
  1076â†’   Spawning refactor agent...
  1077â†’   â†’ [Waiting for completion]
  1078â†’   â†’ [Agent completed successfully]
  1079â†’
  1080â†’3. [Step 5 - Type Safety]
  1081â†’   Spawning quality agent...
  1082â†’   â†’ [Waiting for completion]
  1083â†’   â†’ [Agent completed successfully]
  1084â†’
  1085â†’4. [Step 7 - Data Layer]
  1086â†’   Spawning development agent...
  1087â†’   Instruction: "Use these MCPs: supabase, web-search-prime"
  1088â†’   INSTRUCTION: USE SUPABASE MCP TOOLS to query/verify database directly. USE WEB-SEARCH for research.
  1089â†’   â†’ [Waiting for completion]
  1090â†’   â†’ [Agent completed successfully]
  1091â†’
  1092â†’5. Running quality checks...
  1093â†’   pnpm run typecheck
  1094â†’   â†’ Passed
  1095â†’
  1096â†’6. Committing changes...
  1097â†’   git commit -m "feat: [Story ID] - [Story Title]
  1098â†’
  1099â†’Co-Authored-By: NEXT MAVENS <info@nextmavens.com>"
  1100â†’   â†’ Committed
  1101â†’
  1102â†’7. Updating PRD...
  1103â†’   Setting passes: true for [Story ID]
  1104â†’   â†’ Updated
  1105â†’
  1106â†’8. Logging progress...
  1107â†’   Appending to docs/progress-[feature].txt
  1108â†’   â†’ Logged
  1109â†’
  1110â†’âœ… Story [Story ID] complete
  1111â†’```
  1112â†’
  1113â†’**IMPORTANT: MCP Assignment**
  1114â†’
  1115â†’The PRD file specifies which MCPs to use for each step:
  1116â†’
  1117â†’```json
  1118â†’{
  1119â†’  "id": "US-001",
  1120â†’  "mavenSteps": [1, 7],
  1121â†’  "mcpTools": {
  1122â†’    "step1": ["supabase"],
  1123â†’    "step7": ["supabase", "web-search-prime"]
  1124â†’  }
  1125â†’}
  1126â†’```
  1127â†’
  1128â†’**How it works:**
  1129â†’1. Read the PRD's `mcpTools` for the current step
  1130â†’2. Tell the agent: "Use these MCPs: [list]"
  1131â†’3. Agent figures out how to use them
  1132â†’4. If MCPs aren't specified, agent uses standard tools
  1133â†’
  1134â†’**Simple and direct:**
  1135â†’- No complex discovery or categorization
  1136â†’- No merging or mapping logic
  1137â†’- Just pass the MCP names to the agent
  1138â†’- Agent knows their own tools and how to use them
  1139â†’
  1140â†’## Feature-Based Architecture
  1141â†’
  1142â†’Maven Flow enforces this structure for all new code:
  1143â†’
  1144â†’```
  1145â†’src/
  1146â†’â”œâ”€â”€ app/                    # Entry points, routing
  1147â†’â”œâ”€â”€ features/               # Isolated feature modules
  1148â†’â”‚   â”œâ”€â”€ auth/              # Cannot import from other features
  1149â†’â”‚   â”œâ”€â”€ dashboard/
  1150â†’â”‚   â””â”€â”€ [feature-name]/
  1151â†’â”œâ”€â”€ shared/                # Shared code (no feature imports)
  1152â†’â”‚   â”œâ”€â”€ ui/                # Reusable components
  1153â†’â”‚   â”œâ”€â”€ api/               # Backend clients
  1154â†’â”‚   â””â”€â”€ utils/             # Utilities
  1155â†’```
  1156â†’
  1157â†’**Architecture Rules:**
  1158â†’- Features â†’ Cannot import from other features
  1159â†’- Features â†’ Can import from shared/
  1160â†’- Shared â†’ Cannot import from features
  1161â†’- Use `@shared/*`, `@features/*`, `@app/*` aliases (no relative imports)
  1162â†’
  1163â†’## Tips
  1164â†’
  1165â†’- **Multiple features:** Create separate PRDs for each feature using `flow-prd` skill
  1166â†’- **Story size:** Keep stories small enough for one context window (~30-50 files max)
  1167â†’- **Dependencies:** Order stories by dependency (schema â†’ backend â†’ UI)
  1168â†’- **Quality hooks:** Automatically configured in `maven-flow/.claude/settings.json`
  1169â†’- **Browser verification:** UI stories should include browser testing steps
  1170â†’- **Agent coordination:** The /flow command directly spawns specialist agents for each mavenStep
  1171â†’
  1172â†’### Mobile App Development (Expo/React Native)
  1173â†’
  1174â†’- **Step 11 (design-agent)**: Add to stories for mobile apps to apply professional UI/UX design
  1175â†’- **Design principles**: Based on Apple's design methodology (Structure, Navigation, Content, Visual Design)
  1176â†’- **Expo integration**: Design-agent validates changes using Expo preview
  1177â†’- **When to use**: Include Step 11 in mavenSteps for stories that create or modify mobile UI screens
  1178â†’- **Example PRD story for mobile**:
  1179â†’  ```json
  1180â†’  {
  1181â†’    "id": "US-001",
  1182â†’    "title": "Create mobile home screen",
  1183â†’    "mavenSteps": [1, 3, 5, 6, 11],
  1184â†’    "description": "Create the main home screen for the mobile app"
  1185â†’  }
  1186â†’  ```
  1187â†’
  1188â†’## Quality Standards
  1189â†’
  1190â†’### Zero Tolerance Rules
  1191â†’
  1192â†’**The following violations will BLOCK commits:**
  1193â†’
  1194â†’1. **'any' Types - ZERO TOLERANCE**
  1195â†’   - No `: any`, `: any[]`, `<any>`, `Promise<any>`
  1196â†’   - Use proper interfaces or `unknown` with type guards
  1197â†’
  1198â†’2. **Gradients in CSS - ZERO TOLERANCE**
  1199â†’   - No `linear-gradient`, `radial-gradient`, `conic-gradient`
  1200â†’   - Use solid professional colors only
  1201â†’
  1202â†’3. **Emojis in UI - ZERO TOLERANCE**
  1203â†’   - No emojis anywhere in UI components
  1204â†’   - Use professional icon libraries (lucide-react, heroicons)
  1205â†’   - Never use emojis as icons or in text
  1206â†’
  1207â†’4. **Relative Imports**
  1208â†’   - No `import { Foo } from './foo'` or `../bar`
  1209â†’   - Use `@/` aliases for all imports
  1210â†’
  1211â†’### Component Size Limits
  1212â†’
  1213â†’- **Maximum 300 lines** per component
  1214â†’- Components larger than 300 lines must be split
  1215â†’- Flagged for refactoring agent to modularize
  1216â†’
  1217â†’### Professional Color Palette
  1218â†’
  1219â†’**Semantic Colors:**
  1220â†’```css
  1221â†’--color-primary: #3b82f6;      /* Blue */
  1222â†’--color-success: #10b981;      /* Green */
  1223â†’--color-warning: #f59e0b;      /* Amber */
  1224â†’--color-error: #ef4444;        /* Red */
  1225â†’--color-neutral: #6b7280;      /* Gray */
  1226â†’```
  1227â†’
  1228â†’**Rules:**
  1229â†’- Use semantic color names
  1230â†’- No hard-coded hex values
  1231â†’- No gradients (solid colors only)
  1232â†’
  1233â†’### Import Path Rules
  1234â†’
  1235â†’**âœ… CORRECT:**
  1236â†’```tsx
  1237â†’import { Button } from '@shared/ui';
  1238â†’import { useAuth } from '@features/auth/hooks';
  1239â†’import { apiClient } from '@/shared/api';
  1240â†’```
  1241â†’
  1242â†’**âŒ BLOCKED:**
  1243â†’```tsx
  1244â†’import { Button } from '../../../shared/ui';
  1245â†’import { useAuth } from '../hooks';
  1246â†’```
  1247â†’
  1248â†’---
  1249â†’
  1250â†’## Browser Testing
  1251â†’
  1252â†’### Test User Credentials (Standard Across All Projects)
  1253â†’
  1254â†’**Email:** `revccnt@gmail.com`
  1255â†’**Password:** `Elishiba!90`
  1256â†’
  1257â†’### Testing Process
  1258â†’
  1259â†’**For ALL web applications with browser MCPs:**
  1260â†’
  1261â†’1. **Start dev server:** `pnpm dev`
  1262â†’2. **Navigate to application** using browser MCP
  1263â†’3. **Check browser console** for errors and warnings
  1264â†’4. **Check Network tab** for failed API calls
  1265â†’5. **Test all user flows** with standard test user
  1266â†’6. **Fix any console errors** found
  1267â†’7. **Re-test** to verify clean console
  1268â†’
  1269â†’### Console Log Verification
  1270â†’
  1271â†’**ALWAYS read console logs. Common issues to fix:**
  1272â†’
  1273â†’| Issue | Example | Fix |
  1274â†’|-------|---------|-----|
  1275â†’| ReferenceError | `Uncaught ReferenceError: foo is not defined` | Import or define the variable |
  1276â†’| TypeError | `Cannot read property 'x' of undefined` | Add null checks |
  1277â†’| Failed to fetch | `Failed to fetch: /api/endpoint` | Check API route exists |
  1278â†’| CORS | `CORS policy: No 'Access-Control-Allow-Origin'` | Configure CORS headers |
  1279â†’| 404 / 500 | API returns error status | Fix backend endpoint |
  1280â†’
  1281â†’### Role Switching (Multi-Role Apps)
  1282â†’
  1283â†’**Do NOT create separate accounts for each role. Use role switching:**
  1284â†’
  1285â†’1. Log in as `revccnt@gmail.com`
  1286â†’2. Use role switcher in application
  1287â†’3. Change roles: SUPER_ADMIN â†’ SHOP_OWNER â†’ SHOP_EMPLOYEE
  1288â†’4. Test each role's features
  1289â†’5. Switch back and forth as needed
  1290â†’
  1291â†’---
  1292â†’
  1293â†’## Required MCPs
  1294â†’
  1295â†’### Mandatory MCPs for Maven Flow
  1296â†’
  1297â†’Maven Flow requires specific MCP servers to be configured for autonomous development and testing to function correctly.
  1298â†’
  1299â†’#### Two Mandatory MCPs
  1300â†’
  1301â†’**1. Supabase MCP (MANDATORY)**
  1302â†’- **Purpose:** Direct database access, schema verification, migrations, type generation
  1303â†’- **Why mandatory:**
  1304â†’  - Agents need to QUERY the actual database (not read files)
  1305â†’  - Agents need to VERIFY tables and schema exist
  1306â†’  - Agents need to CREATE tables and run migrations
  1307â†’  - Agents need to GENERATE TypeScript types from live schema
  1308â†’- **Without Supabase MCP:**
  1309â†’  - Agents will fall back to reading migration files (doesn't verify actual database)
  1310â†’  - Agents will create migration scripts manually (error-prone)
  1311â†’  - Agents cannot verify what's actually in the database
  1312â†’
  1313â†’**2. chrome-devtools MCP (MANDATORY)**
  1314â†’- **Purpose:** Live browser testing, console log reading, application verification
  1315â†’- **Why mandatory:**
  1316â†’  - testing-agent MUST open the application to test features
  1317â†’  - Agents MUST read console logs to find errors
  1318â†’  - Agents MUST verify UI works in real browser
  1319â†’  - Agents MUST test user flows end-to-end
  1320â†’- **Without chrome-devtools MCP:**
  1321â†’  - testing-agent cannot test the application
  1322â†’  - Console errors go undetected
  1323â†’  - Features cannot be verified in browser
  1324â†’  - Testing becomes manual and incomplete
  1325â†’
  1326â†’#### How to Verify MCPs Are Configured
  1327â†’
  1328â†’**Before running `/flow start`:**
  1329â†’
  1330â†’1. **Check Claude Code MCP Settings:**
  1331â†’   - Open Claude Code Settings
  1332â†’   - Go to MCP Servers section
  1333â†’   - Verify "supabase" is in the list
  1334â†’   - Verify "chrome-devtools" is in the list
  1335â†’
  1336â†’2. **Test MCPs are working:**
  1337â†’   - Start a conversation
  1338â†’   - Ask agent to list tables using Supabase MCP
  1339â†’   - Ask agent to open browser using chrome-devtools MCP
  1340â†’
  1341â†’3. **If MCPs are missing:**
  1342â†’   - DO NOT start `/flow start`
  1343â†’   - Configure the missing MCP first
  1344â†’   - Restart Claude Code
  1345â†’   - Verify again
  1346â†’
  1347â†’#### Optional MCPs (Recommended but Not Required)
  1348â†’
  1349â†’| MCP Name | Purpose | When to Include |
  1350â†’|----------|---------|-----------------|
  1351â†’| web-search-prime | Research documentation | All steps |
  1352â†’| web-reader | Read web pages | All steps |
  1353â†’| playwright | Browser automation testing | Testing phases |
  1354â†’| wrangler | Cloudflare Workers deployment | Step 9 |
  1355â†’| vercel | Vercel deployment | Step 9 |
  1356â†’| figma | Design work | Step 11 (mobile) |
  1357â†’
  1358â†’**Only include these MCPs if:**
  1359â†’- They are actually configured in your environment
  1360â†’- The story specifically needs them
  1361â†’- You've verified they're available
  1362â†’
  1363â†’#### Summary
  1364â†’
  1365â†’**MANDATORY MCPs (Must Have):**
  1366â†’- âœ… supabase
  1367â†’- âœ… chrome-devtools
  1368â†’
  1369â†’**Before running `/flow start`:**
  1370â†’1. Verify supabase MCP is configured
  1371â†’2. Verify chrome-devtools MCP is configured
  1372â†’3. Test both MCPs work correctly
  1373â†’4. Only then start the flow
  1374â†’
  1375â†’**Remember:** Without these MCPs, Maven Flow cannot function as designed. Agents will fall back to less reliable methods (reading files instead of querying database, manual testing instead of automated browser testing).
  1376â†’
  1377â†’---
  1378â†’
  1379â†’## Testing & Consolidation
  1380â†’
  1381â†’### Workflow: Test â†’ Log â†’ Consolidate â†’ Fix
  1382â†’
  1383â†’Maven Flow includes a systematic testing and error consolidation workflow to ensure quality.
  1384â†’
  1385â†’### Step 1: Test (`/flow test`)
  1386â†’
  1387â†’**Purpose:** Comprehensive automated testing of all completed features
  1388â†’
  1389â†’**What happens:**
  1390â†’1. Reads PRD to find completed stories (where `passes: true`)
  1391â†’2. Starts dev server: `pnpm dev`
  1392â†’3. Opens application using chrome-devtools MCP
  1393â†’4. Tests user signup/login with standard test credentials
  1394â†’5. Tests each completed feature's acceptance criteria
  1395â†’6. Checks console for errors (logs ALL errors found)
  1396â†’7. Tests navigation, forms, data display
  1397â†’8. Creates error log at `docs/errors-[feature-name].md`
  1398â†’
  1399â†’**Standard Test User:**
  1400â†’- Email: `revccnt@gmail.com`
  1401â†’- Password: `Elishiba!90`
  1402â†’
  1403â†’**What gets tested:**
  1404â†’- User authentication (signup, login, logout)
  1405â†’- All completed stories' acceptance criteria
  1406â†’- Console errors (JavaScript, network, API)
  1407â†’- UI functionality
  1408â†’- Navigation between pages
  1409â†’- Form submissions
  1410â†’- Data display
  1411â†’
  1412â†’**Example:**
  1413â†’```bash
  1414â†’/flow test task-priority
  1415â†’```
  1416â†’
  1417â†’**Output:**
  1418â†’- Shows which features are being tested
  1419â†’- Reports errors in real-time
  1420â†’- Creates error log markdown file
  1421â†’- Summary with error counts by severity
  1422â†’
  1423â†’### Step 2: Review Error Log
  1424â†’
  1425â†’**Error log format:** `docs/errors-[feature-name].md`
  1426â†’
  1427â†’**Each error includes:**
  1428â†’- Story ID (US-XXX)
  1429â†’- Severity (Critical / High / Medium / Low)
  1430â†’- Error type (Console Error / Network Error / UI Issue)
  1431â†’- Error message (exact text from console)
  1432â†’- Steps to reproduce
  1433â†’- Expected vs actual behavior
  1434â†’- Related file references
  1435â†’- Suggested fixes
  1436â†’
  1437â†’**Example error log entry:**
  1438â†’```markdown
  1439â†’## Error 1
  1440â†’
  1441â†’**Story:** US-003 - Add priority selector
  1442â†’**Feature:** Task creation form
  1443â†’**Severity:** High
  1444â†’
  1445â†’**Error Type:** Console Error
  1446â†’
  1447â†’**Error Message:**
  1448â†’```
  1449â†’Uncaught TypeError: Cannot read property 'map' of undefined
  1450â†’at PrioritySelector.tsx:24
  1451â†’```
  1452â†’
  1453â†’**Steps to Reproduce:**
  1454â†’1. Navigate to /tasks/create
  1455â†’2. Click on "Priority" dropdown
  1456â†’3. Observe error in console
  1457â†’
  1458â†’**Expected Behavior:**
  1459â†’Priority dropdown shows options: Low, Medium, High, Urgent
  1460â†’
  1461â†’**Actual Behavior:**
  1462â†’Application crashes, dropdown doesn't render
  1463â†’
  1464â†’**Related Files:**
  1465â†’- File: src/features/tasks/components/PrioritySelector.tsx
  1466â†’- Line: 24
  1467â†’- Component: PrioritySelector
  1468â†’
  1469â†’**Suggested Fix:**
  1470â†’Check that priorities prop is defined before mapping. Add default value or null check.
  1471â†’```
  1472â†’
  1473â†’### Step 3: Consolidate (`/flow consolidate`)
  1474â†’
  1475â†’**Purpose:** Fix ONLY the specific errors found during testing (NOT reimplement features)
  1476â†’
  1477â†’**What happens:**
  1478â†’1. Reads error log from `docs/errors-[feature-name].md`
  1479â†’2. Parses each error to identify:
  1480â†’   - Which story (US-XXX) has the error
  1481â†’   - Which step/mavenStep needs to be re-run
  1482â†’   - What the specific error is
  1483â†’3. For each error:
  1484â†’   - Spawns appropriate specialist agent (development, quality, security, etc.)
  1485â†’   - Tells agent exactly what error to fix
  1486â†’   - Waits for fix to be applied
  1487â†’4. Re-tests ONLY the fixed item
  1488â†’5. Marks error as resolved in log
  1489â†’6. Continues until all errors fixed
  1490â†’
  1491â†’**What it does NOT do:**
  1492â†’- Does NOT run full mavenSteps again
  1493â†’- Does NOT re-implement completed features
  1494â†’- Does NOT touch working code
  1495â†’- Only fixes the specific errors identified
  1496â†’
  1497â†’**Example:**
  1498â†’```bash
  1499â†’/flow consolidate task-priority
  1500â†’```
  1501â†’
  1502â†’**Output:**
  1503â†’- Shows which errors are being fixed
  1504â†’- Shows which agent is handling each fix
  1505â†’- Commits each fix separately
  1506â†’- Updates error log as fixes are applied
  1507â†’
  1508â†’### Step 4: Re-test
  1509â†’
  1510â†’After consolidation:
  1511â†’1. Run `/flow test [prd-name]` again
  1512â†’2. Verify all errors are fixed
  1513â†’3. Verify console is clean
  1514â†’4. If errors remain, repeat consolidation
  1515â†’
  1516â†’### Complete Workflow Example
  1517â†’
  1518â†’```bash
  1519â†’# 1. Run development flow
  1520â†’/flow start
  1521â†’
  1522â†’# 2. Test all completed features
  1523â†’/flow test task-priority
  1524â†’
  1525â†’# Output: Testing Complete
  1526â†’# Error Log: docs/errors-task-priority.md
  1527â†’# Total Errors: 5
  1528â†’# Critical: 1 | High: 2 | Medium: 1 | Low: 1
  1529â†’
  1530â†’# 3. Review error log
  1531â†’cat docs/errors-task-priority.md
  1532â†’
  1533â†’# 4. Fix all errors
  1534â†’/flow consolidate task-priority
  1535â†’
  1536â†’# Output:
  1537â†’# Fixing Error 1: TypeError in PrioritySelector
  1538â†’# Spawning quality-agent...
  1539â†’# â†’ Fixed
  1540â†’# Fixing Error 2: Network error in API
  1541â†’# Spawning development-agent...
  1542â†’# â†’ Fixed
  1543â†’# ...
  1544â†’
  1545â†’# 5. Re-test to verify
  1546â†’/flow test task-priority
  1547â†’
  1548â†’# Output: Testing Complete
  1549â†’# Total Errors: 0
  1550â†’# âœ… All features working correctly
  1551â†’```
  1552â†’
  1553â†’### Key Differences: `/flow start` vs `/flow consolidate`
  1554â†’
  1555â†’| Aspect | `/flow start` | `/flow consolidate` |
  1556â†’|--------|---------------|---------------------|
  1557â†’| Purpose | Implement new features | Fix specific errors |
  1558â†’| Input | PRD stories | Error log |
  1559â†’| Runs | Full mavenSteps for each story | Only affected steps |
  1560â†’| Scope | Entire story implementation | Specific error fixes |
  1561â†’| Commits | Full feature commits | Targeted bug fixes |
  1562â†’| Result | New features implemented | Errors resolved |
  1563â†’
  1564â†’---
  1565â†’
  1566â†’
  1567â†’---
  1568â†’
  1569â†’## Mobile Development
  1570â†’
  1571â†’Maven Flow includes comprehensive support for React Native + Expo mobile app development with shared Supabase backend.
  1572â†’
  1573â†’### Quick Start for Mobile
  1574â†’
  1575â†’**Step 1: Setup mobile environment**
  1576â†’```bash
  1577â†’/flow-mobile setup
  1578â†’```
  1579â†’This creates the complete mobile app structure in `mobile/` folder.
  1580â†’
  1581â†’**Step 2: Create mobile PRDs**
  1582â†’```bash
  1583â†’flow-prd-mobile [feature-name]
  1584â†’```
  1585â†’Converts existing web PRDs to mobile-specific PRDs with offline support.
  1586â†’
  1587â†’**Step 3: Sync with web app**
  1588â†’```bash
  1589â†’/flow-mobile sync
  1590â†’```
  1591â†’Syncs database types and configuration from web to mobile.
  1592â†’
  1593â†’**Step 4: Develop mobile features**
  1594â†’```bash
  1595â†’/flow start
  1596â†’```
  1597â†’Maven Flow detects mobile PRDs and uses mobile-app-agent for implementation.
  1598â†’
  1599â†’### Mobile App Structure
  1600â†’
  1601â†’```
  1602â†’mobile/
  1603â†’â”œâ”€â”€ app/                    # Expo Router screens (file-based routing)
  1604â†’â”‚   â”œâ”€â”€ (tabs)/            # Tab navigation screens
  1605â†’â”‚   â”œâ”€â”€ auth/              # Authentication screens
  1606â†’â”‚   â””â”€â”€ _layout.tsx        # Root layout
  1607â†’â”œâ”€â”€ components/            # Mobile-specific components
  1608â†’â”œâ”€â”€ lib/                   # Utilities (Supabase, Firebase, Storage)
  1609â†’â”œâ”€â”€ hooks/                 # Custom React hooks
  1610â†’â”œâ”€â”€ store/                 # Zustand state management
  1611â†’â”œâ”€â”€ constants/             # App constants
  1612â†’â”œâ”€â”€ types/                 # TypeScript types (shared with web)
  1613â†’â”œâ”€â”€ docs/                  # Mobile PRDs
  1614â†’â”‚   â”œâ”€â”€ prd-*.json        # Mobile PRDs
  1615â†’â”‚   â””â”€â”€ progress-*.txt    # Mobile progress files
  1616â†’â””â”€â”€ package.json
  1617â†’```
  1618â†’
  1619â†’### Tech Stack
  1620â†’
  1621â†’| Layer | Technology |
  1622â†’|-------|------------|
  1623â†’| **Framework** | React Native + Expo SDK 51 |
  1624â†’| **Navigation** | Expo Router (file-based routing) |
  1625â†’| **Styling** | NativeWind (Tailwind for React Native) |
  1626â†’| **State** | TanStack Query + Zustand |
  1627â†’| **Auth** | Firebase Authentication |
  1628â†’| **Backend** | Supabase (shared with web app) |
  1629â†’| **Push** | Firebase Cloud Messaging |
  1630â†’| **Offline** | AsyncStorage with auto-sync |
  1631â†’
  1632â†’### Mobile-Specific Features
  1633â†’
  1634â†’#### Offline-First Architecture
  1635â†’All mobile features work offline with automatic sync:
  1636â†’
  1637â†’**Read Pattern:**
  1638â†’1. Check AsyncStorage cache first
  1639â†’2. If fresh (< 5 min), use cached data
  1640â†’3. If missing/stale, fetch from Supabase
  1641â†’4. Update cache and display
  1642â†’
  1643â†’**Write Pattern:**
  1644â†’1. Optimistically update UI immediately
  1645â†’2. If online: Execute immediately
  1646â†’3. If offline: Queue in AsyncStorage
  1647â†’4. When back online: Process queue automatically
  1648â†’
  1649â†’#### Native UI Patterns
  1650â†’Use mobile-specific interactions:
  1651â†’- **Pull-to-refresh** for data reload
  1652â†’- **Swipe actions** for quick actions (delete, complete)
  1653â†’- **Bottom sheets** for options/modals
  1654â†’- **Tab bar** for main navigation
  1655â†’- **Stack navigation** for drilling down
  1656â†’- **Long-press** for context menus
  1657â†’
  1658â†’#### Touch Targets
  1659â†’- **Minimum 44x44 points** for all touch targets (Apple)
  1660â†’- **48x48 dp minimum** for Android
  1661â†’- Adequate spacing between targets
  1662â†’
  1663â†’#### Push Notifications
  1664â†’- Firebase Cloud Messaging for push notifications
  1665â†’- Task assignments, due reminders, status changes
  1666â†’- Background message handling
  1667â†’- Notification channels (Android)
  1668â†’
  1669â†’### Commands
  1670â†’
  1671â†’#### `/flow-mobile setup`
  1672â†’Creates complete React Native + Expo mobile app:
  1673â†’- Installs all dependencies
  1674â†’- Configures Expo Router
  1675â†’- Sets up NativeWind styling
  1676â†’- Configures Supabase client (shared with web)
  1677â†’- Configures Firebase Auth + FCM
  1678â†’- Implements offline storage + sync logic
  1679â†’- Creates base screens and navigation
  1680â†’
  1681â†’#### `/flow-mobile status`
  1682â†’Shows mobile app status:
  1683â†’- Mobile folder existence
  1684â†’- Expo configuration
  1685â†’- Dependencies status
  1686â†’- Supabase connection
  1687â†’- Firebase configuration
  1688â†’- Mobile PRDs and progress
  1689â†’- Offline sync status
  1690â†’
  1691â†’#### `/flow-mobile sync`
  1692â†’Synchronizes web and mobile:
  1693â†’- Database types (from Supabase schema)
  1694â†’- Environment variables
  1695â†’- API endpoints
  1696â†’- Auth configuration
  1697â†’
  1698â†’#### `flow-prd-mobile [feature-name]`
  1699â†’Converts web PRD to mobile PRD:
  1700â†’- Adds offline requirements
  1701â†’- Adds native UI patterns
  1702â†’- Adds touch interactions
  1703â†’- Adds push notification specs
  1704â†’- Creates `mobile/docs/prd-[feature-name].json`
  1705â†’
  1706â†’### Development Workflow
  1707â†’
  1708â†’**For Web Development:**
  1709â†’```bash
  1710â†’# 1. Create web PRD
  1711â†’flow-prd
  1712â†’# 2. Convert to JSON
  1713â†’flow-convert
  1714â†’# 3. Start development
  1715â†’/flow start
  1716â†’```
  1717â†’
  1718â†’**For Mobile Development:**
  1719â†’```bash
  1720â†’# 1. Setup mobile (one-time)
  1721â†’/flow-mobile setup
  1722â†’
  1723â†’# 2. Create mobile PRDs from web PRDs
  1724â†’flow-prd-mobile task-management
  1725â†’flow-prd-mobile user-auth
  1726â†’
  1727â†’# 3. Sync types and config
  1728â†’/flow-mobile sync
  1729â†’
  1730â†’# 4. Start mobile development
  1731â†’/flow start
  1732â†’```
  1733â†’
  1734â†’### Testing Mobile Apps
  1735â†’
  1736â†’**Test with Expo Go (quickest):**
  1737â†’```bash
  1738â†’cd mobile
  1739â†’pnpm start
  1740â†’# Scan QR code with Expo Go app on phone
  1741â†’```
  1742â†’
  1743â†’**Test on iOS simulator:**
  1744â†’```bash
  1745â†’cd mobile
  1746â†’pnpm ios
  1747â†’```
  1748â†’
  1749â†’**Test on Android emulator:**
  1750â†’```bash
  1751â†’cd mobile
  1752â†’pnpm android
  1753â†’```
  1754â†’
  1755â†’**Test offline functionality:**
  1756â†’1. Load app and data
  1757â†’2. Enable Airplane mode
  1758â†’3. Navigate around (data should load from cache)
  1759â†’4. Create/update/delete items
  1760â†’5. Disable Airplane mode
  1761â†’6. Verify sync happens automatically
  1762â†’
  1763â†’### Building and Deploying
  1764â†’
  1765â†’**Build with EAS Build:**
  1766â†’```bash
  1767â†’cd mobile
  1768â†’eas build --platform ios
  1769â†’eas build --platform android
  1770â†’```
  1771â†’
  1772â†’**Submit to stores:**
  1773â†’```bash
  1774â†’eas submit --platform ios
  1775â†’eas submit --platform android
  1776â†’```
  1777â†’
  1778â†’**Over-the-air updates:**
  1779â†’```bash
  1780â†’eas update --branch production
  1781â†’```
  1782â†’
  1783â†’### Shared Backend
  1784â†’
  1785â†’Mobile app shares the same Supabase backend as web:
  1786â†’- Same database schema
  1787â†’- Same RLS policies
  1788â†’- Same API endpoints
  1789â†’- Same types (generated from schema)
  1790â†’
  1791â†’**Sync types:**
  1792â†’```bash
  1793â†’/flow-mobile sync
  1794â†’```
  1795â†’
  1796â†’This generates `mobile/types/database.types.ts` from Supabase schema.
  1797â†’
  1798â†’### Mobile PRD Structure
  1799â†’
  1800â†’Mobile PRDs include additional fields:
  1801â†’
  1802â†’**Offline Requirements:**
  1803â†’```json
  1804â†’"offline": {
  1805â†’  "required": true,
  1806â†’  "cacheKey": "tasks-cache",
  1807â†’  "cacheTTL": 300000,
  1808â†’  "syncStrategy": "auto-on-online"
  1809â†’}
  1810â†’```
  1811â†’
  1812â†’**Native UI Patterns:**
  1813â†’```json
  1814â†’"uiPatterns": {
  1815â†’  "navigation": "tab-bar",
  1816â†’  "actions": {
  1817â†’    "complete": "swipe-left",
  1818â†’    "delete": "swipe-right",
  1819â†’    "edit": "tap-card"
  1820â†’  },
  1821â†’  "refresh": "pull-to-refresh"
  1822â†’}
  1823â†’```
  1824â†’
  1825â†’**Push Notifications:**
  1826â†’```json
  1827â†’"notifications": {
  1828â†’  "enabled": true,
  1829â†’  "events": [
  1830â†’    {
  1831â†’      "event": "task_assigned",
  1832â†’      "title": "New Task Assigned",
  1833â†’      "body": "You've been assigned: {task_title}",
  1834â†’      "tapAction": "navigate_to_task_details"
  1835â†’    }
  1836â†’  ]
  1837â†’}
  1838â†’```
  1839â†’
  1840â†’### Agent Assignments for Mobile
  1841â†’
  1842â†’| Maven Step | Agent | Purpose for Mobile |
  1843â†’|------------|-------|-------------------|
  1844â†’| 1 | mobile-app-agent | Create mobile screens with Expo Router |
  1845â†’| 2 | mobile-app-agent | Mobile dependencies setup |
  1846â†’| 3 | mobile-app-agent | Mobile folder structure |
  1847â†’| 5 | quality-agent | Type safety (same as web) |
  1848â†’| 6 | mobile-app-agent | Centralize mobile components |
  1849â†’| 7 | mobile-app-agent | Supabase integration (shared) |
  1850â†’| 8 | mobile-app-agent | Firebase Auth + push notifications |
  1851â†’| 9 | mobile-app-agent | Mobile MCP integrations |
  1852â†’| 10 | mobile-app-agent | Mobile security + error handling |
  1853â†’| 11 | design-agent | Professional mobile UI/UX |
  1854â†’
  1855â†’### Key Differences: Web vs Mobile
  1856â†’
  1857â†’| Aspect | Web | Mobile |
  1858â†’|--------|-----|--------|
  1859â†’| **Framework** | Next.js | React Native + Expo |
  1860â†’| **Routing** | Next.js App Router | Expo Router |
  1861â†’| **Styling** | Tailwind CSS | NativeWind (Tailwind) |
  1862â†’| **State** | TanStack Query | TanStack Query + AsyncStorage |
  1863â†’| **Navigation** | Links/buttons | Tabs/stacks/gestures |
  1864â†’| **Offline** | Rarely required | **Always required** |
  1865â†’| **Updates** | Realtime | Queue + sync |
  1866â†’| **Notifications** | In-app only | Push (FCM) |
  1867â†’| **Input** | Keyboard + mouse | Touch + keyboard |
  1868â†’| **Touch Targets** | N/A | 44x44pt minimum |
  1869â†’
  1870â†’### Server Management for Mobile
  1871â†’
  1872â†’**Expo server runs on port 8081.**
  1873â†’
  1874â†’**âŒ FORBIDDEN:**
  1875â†’```bash
  1876â†’pkill -9 node
  1877â†’killall node
  1878â†’```
  1879â†’
  1880â†’**âœ… CORRECT:**
  1881â†’```bash
  1882â†’# Find Expo server
  1883â†’lsof -ti:8081
  1884â†’# Kill ONLY that process
  1885â†’kill -9 $(lsof -ti:8081)
  1886â†’```
  1887â†’
  1888â†’## Common Workflows
  1889â†’
  1890â†’### Workflow 1: New Feature with Database
  1891â†’
  1892â†’**Story requires:** Database schema + Backend API + UI
  1893â†’
  1894â†’**Recommended mavenSteps:** `[1, 3, 5, 7, 10]`
  1895â†’
  1896â†’**What happens:**
  1897â†’1. **Step 1 (dev):** Create table with Supabase MCP, generate types
  1898â†’2. **Step 3 (refactor):** Structure to feature-based folders
  1899â†’3. **Step 5 (quality):** Remove 'any' types, add @ aliases
  1900â†’4. **Step 7 (dev):** Create API endpoints, connect to database
  1901â†’5. **Step 10 (security):** Add RLS policies, error handling
  1902â†’
  1903â†’**Total time:** ~1-2 hours
  1904â†’
  1905â†’### Workflow 2: UI Component Only
  1906â†’
  1907â†’**Story requires:** Add new UI component to existing page
  1908â†’
  1909â†’**Recommended mavenSteps:** `[3, 5, 6]`
  1910â†’
  1911â†’**What happens:**
  1912â†’1. **Step 3 (refactor):** Create in feature-based structure
  1913â†’2. **Step 5 (quality):** Type safety, no 'any' types
  1914â†’3. **Step 6 (refactor):** Move reusable parts to @shared/ui
  1915â†’
  1916â†’**Total time:** ~30-45 minutes
  1917â†’
  1918â†’### Workflow 3: Authentication Flow
  1919â†’
  1920â†’**Story requires:** User signup, login, session management
  1921â†’
  1922â†’**Recommended mavenSteps:** `[1, 7, 8, 10]`
  1923â†’
  1924â†’**What happens:**
  1925â†’1. **Step 1 (dev):** Create auth UI pages
  1926â†’2. **Step 7 (dev):** Set up Supabase Auth, Firebase integration
  1927â†’3. **Step 8 (security):** Implement auth flow, RLS policies
  1928â†’4. **Step 10 (security):** Security hardening, error handling
  1929â†’
  1930â†’**Total time:** ~1.5 hours
  1931â†’
  1932â†’### Workflow 4: Mobile App (Expo/React Native)
  1933â†’
  1934â†’**Story requires:** Mobile screen with professional design
  1935â†’
  1936â†’**Recommended mavenSteps:** `[1, 3, 5, 6, 11]`
  1937â†’
  1938â†’**What happens:**
  1939â†’1. **Step 1 (dev):** Create base screen
  1940â†’2. **Step 3 (refactor):** Structure properly
  1941â†’3. **Step 5 (quality):** Type safety
  1942â†’4. **Step 6 (refactor):** Centralize UI components
  1943â†’5. **Step 11 (design):** Apply professional mobile design
  1944â†’
  1945â†’**Total time:** ~1.5-2 hours
  1946â†’
  1947â†’---
  1948â†’
  1949â†’## Troubleshooting
  1950â†’
  1951â†’### Prerequisites Issues
  1952â†’
  1953â†’**Error: `No docs/ directory found`**
  1954â†’```bash
  1955â†’# Fix: Create the directory
  1956â†’mkdir docs
  1957â†’```
  1958â†’
  1959â†’**Error: `No PRD files found in docs/`**
  1960â†’```bash
  1961â†’# Fix: Create a PRD using flow-prd skill
  1962â†’Tell me you want to create a PRD for [feature]
  1963â†’```
  1964â†’
  1965â†’**Message: `All PRDs complete! No work to do.`**
  1966â†’- All stories in all PRDs have `passes: true`
  1967â†’- Create a new PRD or add more stories to existing PRD
  1968â†’
  1969â†’### Flow Execution Issues
  1970â†’
  1971â†’**Flow stops mid-story:**
  1972â†’
  1973â†’1. **Check progress file:**
  1974â†’   ```bash
  1975â†’   cat docs/progress-[feature-name].txt
  1976â†’   ```
  1977â†’
  1978â†’2. **Review recent commits:**
  1979â†’   ```bash
  1980â†’   git log --oneline -10
  1981â†’   ```
  1982â†’
  1983â†’3. **Fix the issue** (code error, typecheck fail, etc.)
  1984â†’
  1985â†’4. **Resume flow:**
  1986â†’   ```bash
  1987â†’   /flow continue
  1988â†’   ```
  1989â†’
  1990â†’**Typecheck failing:**
  1991â†’- Run `pnpm typecheck` to see specific errors
  1992â†’- Fix 'any' types, missing imports, type mismatches
  1993â†’- Run `/flow continue` when fixed
  1994â†’
  1995â†’**Quality agent blocking commit:**
  1996â†’- Check for 'any' types, gradients, emojis
  1997â†’- Fix all BLOCKING issues
  1998â†’- Run `/flow continue`
  1999â†’
  2000â†’### MCP Tool Issues
  2001â†’
  2002â†’**Agent not using MCP tools:**
  2003â†’
  2004â†’1. **Verify MCP is configured:**
  2005â†’   - Check Claude Code MCP settings
  2006â†’   - Ensure MCP server is running
  2007â†’
  2008â†’2. **Check PRD mcpTools:**
  2009â†’   ```json
  2010â†’   "mcpTools": {
  2011â†’     "step1": ["supabase"]
  2012â†’   }
  2013â†’   ```
  2014â†’
  2015â†’3. **Agent should see instruction:**
  2016â†’   ```
  2017â†’   Use these MCPs: supabase
  2018â†’   ```
  2019â†’
  2020â†’4. **If still not working:**
  2021â†’   - Check agent has `tools` field in frontmatter (should NOT have it)
  2022â†’   - Restart Claude Code
  2023â†’   - Try `/flow continue`
  2024â†’
  2025â†’### Architecture Issues
  2026â†’
  2027â†’**Import path errors:**
  2028â†’- Ensure `tsconfig.json` has correct `paths` configuration
  2029â†’- Use `@/` aliases, not relative imports
  2030â†’- quality-agent will auto-fix most import issues
  2031â†’
  2032â†’**Component too large (>300 lines):**
  2033â†’- refactor-agent will split it
  2034â†’- Or manually split before running flow
  2035â†’- Mark story as complete if acceptable
  2036â†’
  2037â†’### Browser Testing Issues
  2038â†’
  2039â†’**Console has errors:**
  2040â†’- Fix all JavaScript errors before marking complete
  2041â†’- Check for missing imports, undefined variables
  2042â†’- Verify API endpoints exist
  2043â†’
  2044â†’**Test user cannot log in:**
  2045â†’- Create user: `revccnt@gmail.com` / `Elishiba!90`
  2046â†’- Verify signup flow works
  2047â†’- Check database for user record
  2048â†’
  2049â†’### Getting Help
  2050â†’
  2051â†’**Still stuck?**
  2052â†’1. Run `/flow status` for detailed diagnostics
  2053â†’2. Check progress file: `docs/progress-[feature-name].txt`
  2054â†’3. Review git history: `git log --oneline -20`
  2055â†’4. Check agent documentation in `.claude/agents/`
  2056â†’
  2057â†’---
  2058â†’
  2059â†’**Flow not starting?**
  2060â†’- Check that at least one `docs/prd-*.json` file exists
  2061â†’- Verify JSON is valid
  2062â†’- Run `/flow status` for detailed diagnostics
  2063â†’
  2064â†’**Iteration failing?**
  2065â†’- Check that PRD's `docs/progress-[feature-name].txt` for errors
  2066â†’- Review git log: `git log --oneline -10`
  2067â†’- Resume with `/flow continue` after fixing issues
  2068â†’
  2069â†’**Wrong PRD being processed?**
  2070â†’- Use `/flow status` to see all PRDs and their status
  2071â†’- Use `/flow continue [prd-name]` to specify which PRD to work on
  2072â†’
  2073â†’**Need to restart a PRD?**
  2074â†’- Use `/flow reset [prd-name]` to archive and begin fresh for that PRD
  2075â†’- Other PRDs remain unaffected
  2076â†’
  2077â†’**Quality hooks not running?**
  2078â†’- Ensure `maven-flow/.claude/settings.json` is configured
  2079â†’- Check that hook scripts are executable: `chmod +x maven-flow/hooks/*.sh`
  2080â†’
  2081â†’---
  2082â†’
  2083â†’## Memory System Architecture
  2084â†’
  2085â†’### Story-Level Memory Files
  2086â†’
  2087â†’Each story gets a permanent memory file: `docs/[feature]/story-US-[###]-[title].txt`
  2088â†’
  2089â†’**Folder Structure:**
  2090â†’```
  2091â†’docs/
  2092â†’â”œâ”€â”€ authentication/              # Story memories folder (auto-created)
  2093â†’â”‚   â”œâ”€â”€ story-US-001-login.txt
  2094â†’â”‚   â”œâ”€â”€ story-US-002-signup.txt
  2095â†’â”‚   â””â”€â”€ story-US-003-reset-password.txt
  2096â†’â”œâ”€â”€ prd-authentication.md       # Human-readable PRD
  2097â†’â”œâ”€â”€ prd-authentication.json     # Machine-readable PRD
  2098â†’â””â”€â”€ consolidated-authentication.txt  # Consolidated memory (after all stories)
  2099â†’```
  2100â†’
  2101â†’**Memory File Format:**
  2102â†’```markdown
  2103â†’---
  2104â†’memoryVersion: 1
  2105â†’schemaVersion: 1
  2106â†’storyId: US-001
  2107â†’storyTitle: User Login
  2108â†’feature: Authentication System
  2109â†’completedDate: 2025-01-18
  2110â†’agents: development-agent, security-agent
  2111â†’---
  2112â†’
  2113â†’# Story US-001: User Login
  2114â†’
  2115â†’## Implemented
  2116â†’- Created users table with id, email, password_hash columns
  2117â†’- Built login UI with email/password fields and validation
  2118â†’- Implemented authenticate() server action
  2119â†’- Added session management with cookies
  2120â†’
  2121â†’## Database Decisions
  2122â†’- Users table in Supabase with RLS policies
  2123â†’- Password hashing using bcrypt (cost factor 10)
  2124â†’- Session tokens stored in supabase_auth.sessions
  2125â†’
  2126â†’## UI/UX Patterns
  2127â†’- Login form uses centralized Form component
  2128â†’- Error messages display inline below fields
  2129â†’- Success redirects to /dashboard
  2130â†’
  2131â†’## Integration Points
  2132â†’- Authentication state managed via React Context (AuthContext)
  2133â†’- Server actions in src/actions/auth.ts
  2134â†’- Session validation middleware for protected routes
  2135â†’
  2136â†’## Lessons Learned
  2137â†’- Always use Supabase MCP for database operations
  2138â†’- Test authentication flow with real credentials
  2139â†’- RLS policies must be applied before testing
  2140â†’
  2141â†’## Best Practices Identified
  2142â†’- Server actions return { success, error, data } pattern
  2143â†’- All auth-related UI components use AuthContext
  2144â†’
  2145â†’## Commit
  2146â†’feat: add user login with email/password authentication
  2147â†’```
  2148â†’
  2149â†’### Consolidated Memory (PRD-Level)
  2150â†’
  2151â†’After ALL stories in a PRD complete, consolidates into `docs/consolidated-[feature].txt` (~30-50K tokens max)
  2152â†’
  2153â†’**Consolidation Rules (HARD CAP):**
  2154â†’- Summarize AGGRESSIVELY - focus on patterns, decisions, interfaces
  2155â†’- AVOID repeating step-by-step details already in story files
  2156â†’- Target ~30-50K tokens maximum
  2157â†’- Story files remain the detailed source; consolidation is for cross-PRD context
  2158â†’
  2159â†’**Consolidation Format:**
  2160â†’```markdown
  2161â†’---
  2162â†’memoryVersion: 1
  2163â†’schemaVersion: 1
  2164â†’feature: Authentication System
  2165â†’consolidatedDate: 2025-01-18
  2166â†’totalStories: 5
  2167â†’---
  2168â†’
  2169â†’# Authentication System - Consolidated Implementation Memory
  2170â†’
  2171â†’## System Overview
  2172â†’Complete user authentication supporting login, signup, password reset, and session management.
  2173â†’
  2174â†’## Key Architectural Decisions
  2175â†’
  2176â†’### Database
  2177â†’- **Supabase as single source of truth** - Always use MCP for queries
  2178â†’- **users table**: id, email, password_hash, created_at, updated_at
  2179â†’- **RLS**: Authenticated users read/write own data only
  2180â†’
  2181â†’### Authentication Flow
  2182â†’1. Email/password â†’ authenticate() action
  2183â†’2. Session token â†’ HTTP-only cookie
  2184â†’3. Protected routes â†’ middleware validation
  2185â†’4. Logout â†’ clear cookie + Supabase session
  2186â†’
  2187â†’## Public Interfaces
  2188â†’
  2189â†’### Server Actions (`src/actions/auth.ts`)
  2190â†’```typescript
  2191â†’authenticate(email, password) â†’ { success, error, data }
  2192â†’register(email, password) â†’ { success, error, data }
  2193â†’requestPasswordReset(email) â†’ { success, error }
  2194â†’resetPassword(token, newPassword) â†’ { success, error }
  2195â†’logout() â†’ { success }
  2196â†’```
  2197â†’
  2198â†’## Integration Patterns
  2199â†’
  2200â†’### For New Features Requiring Auth
  2201â†’1. Wrap with `AuthContext` provider
  2202â†’2. Check `user` state before allowing access
  2203â†’3. Use `authenticate()` for credential validation
  2204â†’4. Apply RLS policies to new tables with `user_id` FK
  2205â†’
  2206â†’## Related PRDs
  2207â†’- **Dashboard PRD**: Requires auth, loads this memory
  2208â†’
  2209â†’## Consolidated From Stories
  2210â†’US-001: User login | US-002: User signup | US-003: Password reset | US-004: Session management | US-005: Logout
  2211â†’```
  2212â†’
  2213â†’### Cross-PRD Memory Loading
  2214â†’
  2215â†’When implementing a PRD that depends on other PRDs:
  2216â†’
  2217â†’1. **Load related consolidated memory** from `relatedPRDs` array
  2218â†’2. **Pre-analyze and summarize** to create focused summary (~3-5K tokens)
  2219â†’3. **Inject into story context** only relevant parts
  2220â†’
  2221â†’**Example: Dashboard PRD depends on Authentication PRD**
  2222â†’```json
  2223â†’{
  2224â†’  "project": "User Dashboard",
  2225â†’  "consolidatedMemory": "docs/consolidated-dashboard.txt",
  2226â†’  "relatedPRDs": ["docs/prd-authentication.json"]
  2227â†’}
  2228â†’```
  2229â†’
  2230â†’**Context budget per story:** ~35K tokens
  2231â†’- Main prompt: ~5K
  2232â†’- Previous stories in same PRD: ~10K
  2233â†’- Related PRD summaries: ~15K
  2234â†’- Agent definitions: referenced, not embedded
  2235â†’- Buffer: ~5K
  2236â†’
  2237â†’---
  2238â†’
  2239â†’## Signal Format
  2240â†’
  2241â†’### Story Complete Signal
  2242â†’
  2243â†’After each story completes, output this signal:
  2244â†’
  2245â†’```xml
  2246â†’<STORY_COMPLETE>
  2247â†’<story_id>US-001</story_id>
  2248â†’<story_title>User login</story_title>
  2249â†’<feature>Authentication System</feature>
  2250â†’<agents_used>development-agent, security-agent</agents_used>
  2251â†’<commit>feat: add user login with email/password authentication</commit>
  2252â†’<memory_file>docs/authentication/story-US-001-login.txt</memory_file>
  2253â†’</STORY_COMPLETE>
  2254â†’```
  2255â†’
  2256â†’**Signal triggers:**
  2257â†’1. Create/update `docs/[feature]/story-US-[###]-[title].txt`
  2258â†’2. Update PRD JSON: `passes: true`
  2259â†’3. Commit changes with proper format
  2260â†’4. Output signal to indicate completion
  2261â†’
  2262â†’### All Complete Signal
  2263â†’
  2264â†’After ALL stories in a PRD complete, output this signal:
  2265â†’
  2266â†’```xml
  2267â†’<ALL_COMPLETE>
  2268â†’<feature>Authentication System</feature>
  2269â†’<total_stories>5</total_stories>
  2270â†’<completed_stories>5</completed_stories>
  2271â†’<consolidated_memory>docs/consolidated-authentication.txt</consolidated_memory>
  2272â†’</ALL_COMPLETE>
  2273â†’```
  2274â†’
  2275â†’**Signal triggers:**
  2276â†’1. Spawn consolidation agent
  2277â†’2. Consolidate all story memories into `docs/consolidated-[feature].txt`
  2278â†’3. Hard cap at ~30-50K tokens (aggressive summarization)
  2279â†’4. Output signal with consolidation path
  2280â†’
  2281â†’---
  2282â†’
  2283â†’## Enhanced Story Processing Flow
  2284â†’
  2285â†’### With Memory System and Signals
  2286â†’
  2287â†’When processing each story:
  2288â†’
  2289â†’```markdown
  2290â†’## Story: US-001 - User Login
  2291â†’
  2292â†’**From PRD:**
  2293â†’- Feature: Authentication System
  2294â†’- mavenSteps: [1, 7, 10]
  2295â†’- mcpTools: { step1: ["supabase"], step7: ["supabase"], step10: [] }
  2296â†’- relatedPRDs: []
  2297â†’
  2298â†’**Loading Context:**
  2299â†’- Previous stories in this PRD: 0
  2300â†’- Related PRD memories: 0
  2301â†’
  2302â†’**Processing:**
  2303â†’
  2304â†’1. [Step 1 - Foundation]
  2305â†’   Spawning development agent...
  2306â†’   â†’ [Agent completed successfully]
  2307â†’
  2308â†’2. [Step 7 - Data Layer]
  2309â†’   Spawning development agent...
  2310â†’   â†’ [Agent completed successfully]
  2311â†’
  2312â†’3. [Step 10 - Security & Error Handling]
  2313â†’   Spawning security agent...
  2314â†’   â†’ [Agent completed successfully]
  2315â†’
  2316â†’4. Running quality checks...
  2317â†’   pnpm run typecheck
  2318â†’   â†’ Passed
  2319â†’
  2320â†’5. Committing changes...
  2321â†’   git commit -m "feat: add user login with email/password authentication"
  2322â†’   â†’ Committed
  2323â†’
  2324â†’6. Creating story memory...
  2325â†’   Writing docs/authentication/story-US-001-login.txt
  2326â†’   â†’ Created
  2327â†’
  2328â†’7. Updating PRD...
  2329â†’   Setting passes: true for US-001
  2330â†’   â†’ Updated
  2331â†’
  2332â†’<STORY_COMPLETE>
  2333â†’<story_id>US-001</story_id>
  2334â†’<story_title>User login</story_title>
  2335â†’<feature>Authentication System</feature>
  2336â†’<agents_used>development-agent, development-agent, security-agent</agents_used>
  2337â†’<commit>feat: add user login with email/password authentication</commit>
  2338â†’<memory_file>docs/authentication/story-US-001-login.txt</memory_file>
  2339â†’</STORY_COMPLETE>
  2340â†’
  2341â†’âœ… Story US-001 complete
  2342â†’```
  2343â†’
  2344â†’### Consolidation Flow (When All Stories Complete)
  2345â†’
  2346â†’```markdown
  2347â†’## All Stories Complete - Consolidating
  2348â†’
  2349â†’**Feature:** Authentication System
  2350â†’**Total Stories:** 5
  2351â†’**Completed Stories:** 5
  2352â†’
  2353â†’1. Spawning consolidation agent...
  2354â†’   â†’ Reading all story memory files
  2355â†’   â†’ Summarizing patterns, decisions, interfaces
  2356â†’   â†’ Target: ~30-50K tokens (hard cap)
  2357â†’   â†’ [Agent completed successfully]
  2358â†’
  2359â†’2. Creating consolidated memory...
  2360â†’   Writing docs/consolidated-authentication.txt
  2361â†’   â†’ Created (14,234 tokens)
  2362â†’
  2363â†’<ALL_COMPLETE>
  2364â†’<feature>Authentication System</feature>
  2365â†’<total_stories>5</total_stories>
  2366â†’<completed_stories>5</completed_stories>
  2367â†’<consolidated_memory>docs/consolidated-authentication.txt</consolidated_memory>
  2368â†’</ALL_COMPLETE>
  2369â†’
  2370â†’âœ… All stories complete for Authentication System
  2371â†’```
  2372â†’
  2373â†’---
  2374â†’
  2375â†’## Folder Creation and Memory Management
  2376â†’
  2377â†’### Automatic Folder Creation
  2378â†’
  2379â†’The flow automatically creates the `docs/[feature]/` folder when processing the first story of a PRD:
  2380â†’
  2381â†’```bash
  2382â†’# First story of authentication PRD
  2383â†’docs/authentication/                    # Auto-created
  2384â†’â”œâ”€â”€ story-US-001-login.txt            # Created after US-001 complete
  2385â†’â”œâ”€â”€ story-US-002-signup.txt           # Created after US-002 complete
  2386â†’â””â”€â”€ story-US-003-reset-password.txt   # Created after US-003 complete
  2387â†’```
  2388â†’
  2389â†’### Memory File Updates
  2390â†’
  2391â†’When a story is re-run (e.g., after consolidation):
  2392â†’1. Read existing memory file
  2393â†’2. Append new learnings
  2394â†’3. Update `memoryVersion` if format changes
  2395â†’4. Keep full history of iterations
  2396â†’
  2397â†’### Memory Versioning
  2398â†’
  2399â†’Each memory file includes version info for future compatibility:
  2400â†’
  2401â†’```yaml
  2402â†’---
  2403â†’memoryVersion: 1
  2404â†’schemaVersion: 1
  2405â†’---
  2406â†’```
  2407â†’
  2408â†’**Benefits:**
  2409â†’- System evolution: Old memories won't be misinterpreted
  2410â†’- Backward compatibility: Agents can adapt behavior based on version
  2411â†’- Migration support: Clear path for upgrading memory formats
  2412â†’- Debugging: Version mismatches immediately visible
  2413â†’
  2414â†’---
  2415â†’
  2416â†’## Terminal Command Integration
  2417â†’
  2418â†’The terminal forwarder scripts (`bin/flow.sh`, `bin/flow-prd.sh`, `bin/flow-convert.sh`) invoke these Claude Code commands directly.
  2419â†’
  2420â†’**Terminal â†’ Claude Code mapping:**
  2421â†’```bash
  2422â†’flow start           â†’ /flow start
  2423â†’flow status          â†’ /flow status
  2424â†’flow-prd create ...  â†’ /flow-prd create ...
  2425â†’flow-convert auth    â†’ /flow-convert auth
  2426â†’```
  2427â†’
  2428â†’The terminal scripts are minimal - they just forward user input to Claude Code which handles all the actual work.
  2429â†’
  2430â†’---
  2431â†’
  2432â†’## Help
  2433â†’
  2434â†’### `/flow help`
  2435â†’
  2436â†’Displays comprehensive help information for Maven Flow.
  2437â†’
  2438â†’```bash
  2439â†’/flow help
  2440â†’flow help
  2441â†’```
  2442â†’
  2443â†’### Quick Reference
  2444â†’
  2445â†’| Command | Description | Usage |
  2446â†’|---------|-------------|-------|
  2447â†’| `start [n]` | Start autonomous development | `flow start 10` |
  2448â†’| `status` | Show progress across all PRDs | `flow status` |
  2449â†’| `continue [prd] [n]` | Resume from last iteration | `flow continue auth 5` |
  2450â†’| `reset [prd]` | Archive and reset a PRD | `flow reset auth` |
  2451â†’| `test [prd]` | Test implemented features | `flow test auth` |
  2452â†’| `consolidate [prd]` | Fix errors from testing | `flow consolidate auth` |
  2453â†’| `help` | Show this help | `flow help` |
  2454â†’
  2455â†’### Memory System Overview
  2456â†’
  2457â†’Maven Flow uses a three-layer memory ecosystem:
  2458â†’
  2459â†’1. **Story Memory** (`docs/[feature]/story-US-[###]-[title].txt`)
  2460â†’   - Created after each story completes
  2461â†’   - Contains: implemented, decisions, challenges, lessons
  2462â†’
  2463â†’2. **Consolidated Memory** (`docs/consolidated-[feature].txt`)
  2464â†’   - Created when ALL stories in PRD complete
  2465â†’   - Aggressively summarized to ~30-50K tokens
  2466â†’   - Contains: architecture, interfaces, integration patterns
  2467â†’
  2468â†’3. **Cross-PRD Context** (assembled dynamically)
  2469â†’   - Related PRD summaries (~3-5K tokens per PRD)
  2470â†’   - Previous story summaries (~10K tokens total)
  2471â†’   - Assembled before spawning agents
  2472â†’
  2473â†’### Feature Relationships
  2474â†’
  2475â†’PRDs can have relationships with other PRDs:
  2476â†’
  2477â†’| Type | Description | Example |
  2478â†’|------|-------------|---------|
  2479â†’| `depends_on` | This PRD depends on another | Payments â†’ Authentication |
  2480â†’| `depended_by` | Another PRD depends on this | Payments â† Orders |
  2481â†’| `bidirectional` | Mutual dependency (rare) | Auth â†” Profiles |
  2482â†’
  2483â†’### Maven Steps
  2484â†’
  2485â†’Each story specifies which Maven steps to execute:
  2486â†’
  2487â†’| Step | Agent | Description |
  2488â†’|------|-------|-------------|
  2489â†’| 1 | development | Foundation - Import UI or create from scratch |
  2490â†’| 2 | development | Package Manager - Convert npm â†’ pnpm |
  2491â†’| 3 | refactor | Feature Structure - Feature-based folders |
  2492â†’| 4 | refactor | Modularization - Split components >300 lines |
  2493â†’| 5 | quality | Type Safety - No 'any' types, @ aliases |
  2494â†’| 6 | refactor | UI Centralization - Move to @shared/ui |
  2495â†’| 7 | development | Data Layer - Backend setup, Supabase |
  2496â†’| 8 | security | Auth Integration - Firebase + Supabase |
  2497â†’| 9 | development | MCP Integration - Connect MCP tools |
  2498â†’| 10 | security | Security & Error Handling |
  2499â†’| 11 | design | Mobile Design - Professional UI (optional) |
  2500â†’
  2501â†’### MCP Tools
  2502â†’
  2503â†’MCPs (Model Context Protocol) are assigned per step:
  2504â†’
  2505â†’```json
  2506â†’{
  2507â†’  "mcpTools": {
  2508â†’    "step1": ["supabase"],
  2509â†’    "step7": ["supabase", "web-search-prime"]
  2510â†’  }
  2511â†’}
  2512â†’```
  2513â†’
  2514â†’**Common MCPs:**
  2515â†’- `supabase` - Database operations (steps 1, 7, 8, 10)
  2516â†’- `chrome-devtools` - Browser testing (testing phases)
  2517â†’- `web-search-prime` - Research, documentation (all steps)
  2518â†’- `web-reader` - Read web content (all steps)
  2519â†’
  2520â†’### Quality Standards
  2521â†’
  2522â†’**Zero Tolerance Rules:**
  2523â†’
  2524â†’1. **'any' Types - ZERO TOLERANCE**
  2525â†’   - No `: any`, `: any[]`, `<any>`, `Promise<any>`
  2526â†’   - Use proper interfaces or `unknown` with type guards
  2527â†’
  2528â†’2. **Gradients in CSS - ZERO TOLERANCE**
  2529â†’   - No `linear-gradient`, `radial-gradient`, `conic-gradient`
  2530â†’   - Use solid professional colors only
  2531â†’
  2532â†’3. **Emojis in UI - ZERO TOLERANCE**
  2533â†’   - No emojis anywhere in UI components
  2534â†’   - Use professional icon libraries (lucide-react, heroicons)
  2535â†’
  2536â†’4. **Relative Imports**
  2537â†’   - No `import { Foo } from './foo'` or `../bar`
  2538â†’   - Use `@/` aliases for all imports
  2539â†’
  2540â†’### File Structure
  2541â†’
  2542â†’```
  2543â†’docs/
  2544â†’â”œâ”€â”€ [feature]/                          # Story memories folder
  2545â†’â”‚   â”œâ”€â”€ story-US-001-[title].txt       # Story: US-001
  2546â†’â”‚   â””â”€â”€ story-US-002-[title].txt       # Story: US-002
  2547â†’â”œâ”€â”€ prd-[feature].md                   # Human-readable PRD
  2548â†’â”œâ”€â”€ prd-[feature].json                 # Machine-readable PRD
  2549â†’â”œâ”€â”€ consolidated-[feature].txt          # Consolidated memory
  2550â†’â””â”€â”€ progress-[feature].txt             # Progress log
  2551â†’```
  2552â†’
  2553â†’### Common Workflows
  2554â†’
  2555â†’**New Feature:**
  2556â†’```bash
  2557â†’1. flow-prd create "feature description"
  2558â†’2. flow-convert feature
  2559â†’3. flow start
  2560â†’4. flow status
  2561â†’```
  2562â†’
  2563â†’**Resume After Error:**
  2564â†’```bash
  2565â†’1. Fix the error
  2566â†’2. flow continue
  2567â†’```
  2568â†’
  2569â†’**Test Implementation:**
  2570â†’```bash
  2571â†’1. flow test [prd]
  2572â†’2. Review docs/errors-[prd].md
  2573â†’3. flow consolidate [prd]
  2574â†’```
  2575â†’
  2576â†’**Start Fresh:**
  2577â†’```bash
  2578â†’1. flow reset [prd]
  2579â†’2. flow start
  2580â†’```
  2581â†’
  2582â†’### Getting More Help
  2583â†’
  2584â†’**For specific topics:**
  2585â†’- PRD Creation: See `.claude/commands/flow-prd.md`
  2586â†’- PRD Conversion: See `.claude/skills/flow-convert/SKILL.md`
  2587â†’- Terminal Scripts: See `bin/README.md`
  2588â†’- Memory System: See main `README.md`
  2589â†’
  2590â†’**For troubleshooting:**
  2591â†’- Run `flow status` for diagnostics
  2592â†’- Check progress file: `docs/progress-[feature].txt`
  2593â†’- Review git log: `git log --oneline -10`
  2594â†’
  2595â†’---
  2596â†’
  2597â†’*Maven Flow: Autonomous AI development with comprehensive quality assurance, multi-PRD support, and intelligent memory management powered by Claude Code CLI*
  2598â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
