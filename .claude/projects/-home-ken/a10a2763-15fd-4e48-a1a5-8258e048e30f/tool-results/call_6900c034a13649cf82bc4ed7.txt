   710â†’    if [ "$incomplete_count" -eq 0 ]; then
   711â†’        return 0  # All complete
   712â†’    else
   713â†’        return 1  # Some incomplete
   714â†’    fi
   715â†’}
   716â†’
   717â†’# Main flow
   718â†’write_header "Maven Flow - Starting"
   719â†’
   720â†’# Check if plan.md exists for context
   721â†’PLAN_CONTEXT=""
   722â†’if [ -f "plan.md" ]; then
   723â†’    echo -e "${CYAN}Found plan.md - using as additional context${NC}"
   724â†’    PLAN_CONTEXT="
   725â†’PLAN CONTEXT:
   726â†’The user has a plan.md file with overall project direction. Use this as context when making decisions about feature interactions and prioritization.
   727â†’"
   728â†’fi
   729â†’
   730â†’# Commit and push any existing changes first
   731â†’commit_and_push_changes
   732â†’
   733â†’# ============================================================================
   734â†’# Main Execution Loop
   735â†’# ============================================================================
   736â†’STORIES_PROCESSED=0
   737â†’
   738â†’for ((iteration=1; iteration<=MAX_ITERATIONS; iteration++)); do
   739â†’    write_iteration_header "$iteration" "$MAX_ITERATIONS"
   740â†’
   741â†’    # Get first incomplete story
   742â†’    local story_result=$(get_first_incomplete_story)
   743â†’
   744â†’    if [ $? -ne 0 ]; then
   745â†’        # No more incomplete stories
   746â†’        current_time=$(date +%s)
   747â†’        duration=$((current_time - START_TIME))
   748â†’        write_complete "$((iteration - 1))" "$duration"
   749â†’
   750â†’        # Final commit and push
   751â†’        commit_and_push_changes
   752â†’
   753â†’        echo -e "${GREEN}${NC}"
   754â†’        echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
   755â†’        echo -e "${GREEN}  ðŸŽ‰ ALL STORIES COMPLETE! ðŸŽ‰${NC}"
   756â†’        echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
   757â†’        echo ""
   758â†’        exit 0
   759â†’    fi
   760â†’
   761â†’    IFS='|' read -r prd_file story_id story_title story_description <<< "$story_result"
   762â†’    local story_line="$story_id|$story_title|$story_description"
   763â†’
   764â†’    # Process this story
   765â†’    if process_story "$prd_file" "$story_line"; then
   766â†’        STORIES_PROCESSED=$((STORIES_PROCESSED + 1))
   767â†’    fi
   768â†’
   769â†’    # Check if we should continue
   770â†’    stats=$(get_story_stats)
   771â†’    IFS='|' read -r total completed remaining progress <<< "$stats"
   772â†’
   773â†’    if [ $total -gt 0 ] && [ $completed -eq $total ]; then
   774â†’        # All stories complete
   775â†’        current_time=$(date +%s)
   776â†’        duration=$((current_time - START_TIME))
   777â†’        write_complete "$iteration" "$duration"
   778â†’
   779â†’        # Final commit and push
   780â†’        commit_and_push_changes
   781â†’
   782â†’        echo ""
   783â†’        exit 0
   784â†’    fi
   785â†’
   786â†’    # Small pause between stories
   787â†’    if [ $iteration -lt $MAX_ITERATIONS ]; then
   788â†’        echo ""
   789â†’        echo -e "${GRAY}Pausing ${SLEEP_SECONDS}s before next story...${NC}"
   790â†’        sleep "$SLEEP_SECONDS"
   791â†’        echo ""
   792â†’    fi
   793â†’done
   794â†’
   795â†’# Max iterations reached
   796â†’write_max_reached "$MAX_ITERATIONS"
   797â†’
   798â†’# Final commit and push before exiting
   799â†’commit_and_push_changes
   800â†’
   801â†’exit 0
   802â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
