/home/ken/developer-portal/src/features/abuse-controls/lib/notifications.ts-45-      `
/home/ken/developer-portal/src/features/abuse-controls/lib/notifications.ts-46-      SELECT DISTINCT
developer-portal/src/features/abuse-controls/lib/notifications.ts:47:        u.id as user_id,
/home/ken/developer-portal/src/features/abuse-controls/lib/notifications.ts-48-        u.email,
/home/ken/developer-portal/src/features/abuse-controls/lib/notifications.ts-49-        u.name,
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notifications.ts-52-      JOIN organizations o ON p.org_id = o.id
/home/ken/developer-portal/src/features/abuse-controls/lib/notifications.ts-53-      LEFT JOIN organization_members om ON o.id = om.org_id
developer-portal/src/features/abuse-controls/lib/notifications.ts:54:      LEFT JOIN users u ON om.user_id = u.id OR o.owner_id = u.id
/home/ken/developer-portal/src/features/abuse-controls/lib/notifications.ts-55-      WHERE p.id = $1
/home/ken/developer-portal/src/features/abuse-controls/lib/notifications.ts-56-        AND u.id IS NOT NULL
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notifications.ts-60-
/home/ken/developer-portal/src/features/abuse-controls/lib/notifications.ts-61-    const allRecipients = result.rows.map((row) => ({
developer-portal/src/features/abuse-controls/lib/notifications.ts:62:      id: row.user_id,
developer-portal/src/features/abuse-controls/lib/notifications.ts-63-      email: row.email,
developer-portal/src/features/abuse-controls/lib/notifications.ts-64-      name: row.name || undefined,
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-18-export interface NotificationPreference {
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-19-  id: string
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:20:  user_id: string
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-21-  project_id: string | null
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-22-  notification_type: NotificationType
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-39- * Get notification preferences for a user
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-40- *
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:41: * @param userId - The user ID to get preferences for
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-42- * @param projectId - Optional project ID to filter by
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-43- * @returns Array of notification preferences
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-44- */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-45-export async function getNotificationPreferences(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:46:  userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-47-  projectId?: string
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-48-): Promise<NotificationPreference[]> {
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-53-      SELECT
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-54-        id,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:55:        user_id,
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-56-        project_id,
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-57-        notification_type,
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-61-        updated_at
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-62-      FROM notification_preferences
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:63:      WHERE user_id = $1
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-64-    `
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:65:    const params: (string | null)[] = [userId]
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-66-
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-67-    if (projectId) {
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-76-    return result.rows.map((row) => ({
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-77-      id: row.id,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:78:      user_id: row.user_id,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-79-      project_id: row.project_id,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-80-      notification_type: row.notification_type as NotificationType,
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-93- * Get notification preference for a specific type
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-94- *
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:95: * @param userId - The user ID
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-96- * @param notificationType - The notification type
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-97- * @param projectId - Optional project ID
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-99- */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-100-export async function getNotificationPreference(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:101:  userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-102-  notificationType: NotificationType,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-103-  projectId?: string
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-110-      SELECT
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-111-        id,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:112:        user_id,
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-113-        project_id,
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-114-        notification_type,
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-118-        updated_at
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-119-      FROM notification_preferences
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:120:      WHERE user_id = $1
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-121-        AND notification_type = $2
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-122-        AND project_id IS NOT DISTINCT FROM $3
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-124-      LIMIT 1
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-125-      `,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:126:      [userId, notificationType, projectId || null]
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-127-    )
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-128-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-135-    return {
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-136-      id: row.id,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:137:      user_id: row.user_id,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-138-      project_id: row.project_id,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-139-      notification_type: row.notification_type as NotificationType,
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-152- * Upsert notification preference
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-153- *
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:154: * @param userId - The user ID
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-155- * @param notificationType - The notification type
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-156- * @param enabled - Whether notifications are enabled
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-160- */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-161-export async function upsertNotificationPreference(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:162:  userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-163-  notificationType: NotificationType,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-164-  enabled: boolean,
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-171-    const result = await pool.query(
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-172-      `
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:173:      INSERT INTO notification_preferences (user_id, project_id, notification_type, enabled, channels)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-174-      VALUES ($1, $2, $3, $4, $5)
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:175:      ON CONFLICT (user_id, project_id, notification_type)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-176-      DO UPDATE SET
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-177-        enabled = EXCLUDED.enabled,
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-180-      RETURNING id
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-181-      `,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:182:      [userId, projectId || null, notificationType, enabled, channels]
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-183-    )
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-184-
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-185-    console.log(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:186:      `[NotificationPreferences] Upserted preference for user ${userId}, type ${notificationType}`
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-187-    )
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-188-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-197- * Delete notification preference
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-198- *
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:199: * @param userId - The user ID
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-200- * @param notificationType - The notification type
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-201- * @param projectId - Optional project ID
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-203- */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-204-export async function deleteNotificationPreference(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:205:  userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-206-  notificationType: NotificationType,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-207-  projectId?: string
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-213-      `
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-214-      DELETE FROM notification_preferences
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:215:      WHERE user_id = $1
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-216-        AND notification_type = $2
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-217-        AND project_id IS NOT DISTINCT FROM $3
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-218-      `,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:219:      [userId, notificationType, projectId || null]
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-220-    )
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-221-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-224-    if (deleted > 0) {
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-225-      console.log(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:226:        `[NotificationPreferences] Deleted preference for user ${userId}, type ${notificationType}`
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-227-      )
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-228-    }
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-278- * Apply default notification preferences for a new user
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-279- *
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:280: * @param userId - The user ID to apply defaults for
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-281- * @returns Whether the operation was successful
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-282- */
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:283:export async function applyDefaultNotificationPreferences(userId: string): Promise<boolean> {
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-284-  const pool = getPool()
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-285-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-290-      await pool.query(
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-291-        `
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:292:        INSERT INTO notification_preferences (user_id, notification_type, enabled, channels)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-293-        VALUES ($1, $2, $3, $4)
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:294:        ON CONFLICT (user_id, project_id, notification_type) DO NOTHING
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-295-        `,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:296:        [userId, preference.notification_type, preference.enabled, preference.channels]
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-297-      )
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-298-    }
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-299-
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:300:    console.log(`[NotificationPreferences] Applied default preferences for user ${userId}`)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-301-
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-302-    return true
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-310- * Check if a user should receive a notification
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-311- *
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:312: * @param userId - The user ID
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-313- * @param notificationType - The notification type
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-314- * @param projectId - Optional project ID
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-316- */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-317-export async function shouldReceiveNotification(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:318:  userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-319-  notificationType: NotificationType,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-320-  projectId?: string
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-321-): Promise<boolean> {
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-322-  try {
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:323:    const preference = await getNotificationPreference(userId, notificationType, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-324-
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-325-    // If no preference exists, default to enabled
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-339- * Get enabled channels for a notification type
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-340- *
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:341: * @param userId - The user ID
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-342- * @param notificationType - The notification type
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-343- * @param projectId - Optional project ID
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-345- */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-346-export async function getEnabledChannels(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:347:  userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-348-  notificationType: NotificationType,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-349-  projectId?: string
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-350-): Promise<NotificationChannel[]> {
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-351-  try {
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:352:    const preference = await getNotificationPreference(userId, notificationType, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-353-
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-354-    // If no preference exists, default to email
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-375-   */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-376-  static async getAll(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:377:    userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-378-    projectId?: string
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-379-  ): Promise<NotificationPreference[]> {
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:380:    return getNotificationPreferences(userId, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-381-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-382-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-385-   */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-386-  static async get(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:387:    userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-388-    notificationType: NotificationType,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-389-    projectId?: string
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-390-  ): Promise<NotificationPreference | null> {
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:391:    return getNotificationPreference(userId, notificationType, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-392-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-393-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-396-   */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-397-  static async set(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:398:    userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-399-    notificationType: NotificationType,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-400-    enabled: boolean,
--
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-402-    projectId?: string
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-403-  ): Promise<string> {
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:404:    return upsertNotificationPreference(userId, notificationType, enabled, channels, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-405-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-406-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-409-   */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-410-  static async setMany(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:411:    userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-412-    preferences: NotificationPreferenceInput[],
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-413-    projectId?: string
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-417-    for (const preference of preferences) {
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-418-      const id = await upsertNotificationPreference(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:419:        userId,
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-420-        preference.notification_type,
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-421-        preference.enabled,
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-433-   */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-434-  static async delete(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:435:    userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-436-    notificationType: NotificationType,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-437-    projectId?: string
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-438-  ): Promise<boolean> {
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:439:    return deleteNotificationPreference(userId, notificationType, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-440-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-441-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-444-   */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-445-  static async shouldReceive(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:446:    userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-447-    notificationType: NotificationType,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-448-    projectId?: string
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-449-  ): Promise<boolean> {
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:450:    return shouldReceiveNotification(userId, notificationType, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-451-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-452-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-455-   */
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-456-  static async getChannels(
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:457:    userId: string,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-458-    notificationType: NotificationType,
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-459-    projectId?: string
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-460-  ): Promise<NotificationChannel[]> {
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:461:    return getEnabledChannels(userId, notificationType, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-462-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-463-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-465-   * Apply default preferences for a new user
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-466-   */
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:467:  static async applyDefaults(userId: string): Promise<boolean> {
developer-portal/src/features/abuse-controls/lib/notification-preferences.ts:468:    return applyDefaultNotificationPreferences(userId)
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-469-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-preferences.ts-470-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-841-   * Get all notification preferences for a user
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-842-   */
developer-portal/src/features/abuse-controls/lib/data-layer.ts:843:  static async getAll(userId: string, projectId?: string) {
developer-portal/src/features/abuse-controls/lib/data-layer.ts:844:    return getNotificationPreferences(userId, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-845-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-846-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-848-   * Get a specific notification preference
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-849-   */
developer-portal/src/features/abuse-controls/lib/data-layer.ts:850:  static async get(userId: string, notificationType: string, projectId?: string) {
developer-portal/src/features/abuse-controls/lib/data-layer.ts:851:    return getNotificationPreference(userId, notificationType as any, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-852-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-853-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-856-   */
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-857-  static async set(
developer-portal/src/features/abuse-controls/lib/data-layer.ts:858:    userId: string,
developer-portal/src/features/abuse-controls/lib/data-layer.ts-859-    notificationType: string,
developer-portal/src/features/abuse-controls/lib/data-layer.ts-860-    enabled: boolean,
--
developer-portal/src/features/abuse-controls/lib/data-layer.ts-862-    projectId?: string
developer-portal/src/features/abuse-controls/lib/data-layer.ts-863-  ): Promise<string> {
developer-portal/src/features/abuse-controls/lib/data-layer.ts:864:    return upsertNotificationPreference(userId, notificationType as any, enabled, channels as any[], projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-865-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-866-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-868-   * Set multiple preferences at once
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-869-   */
developer-portal/src/features/abuse-controls/lib/data-layer.ts:870:  static async setMany(userId: string, preferences: Array<{
developer-portal/src/features/abuse-controls/lib/data-layer.ts-871-    notification_type: string
developer-portal/src/features/abuse-controls/lib/data-layer.ts-872-    enabled: boolean
--
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-877-    for (const preference of preferences) {
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-878-      const id = await upsertNotificationPreference(
developer-portal/src/features/abuse-controls/lib/data-layer.ts:879:        userId,
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-880-        preference.notification_type as any,
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-881-        preference.enabled,
--
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-892-   * Delete a notification preference
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-893-   */
developer-portal/src/features/abuse-controls/lib/data-layer.ts:894:  static async delete(userId: string, notificationType: string, projectId?: string): Promise<boolean> {
developer-portal/src/features/abuse-controls/lib/data-layer.ts:895:    return deleteNotificationPreference(userId, notificationType as any, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-896-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-897-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-899-   * Check if user should receive notification
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-900-   */
developer-portal/src/features/abuse-controls/lib/data-layer.ts:901:  static async shouldReceive(userId: string, notificationType: string, projectId?: string): Promise<boolean> {
developer-portal/src/features/abuse-controls/lib/data-layer.ts:902:    return shouldReceiveNotification(userId, notificationType as any, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-903-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-904-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-906-   * Get enabled channels for a notification type
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-907-   */
developer-portal/src/features/abuse-controls/lib/data-layer.ts:908:  static async getChannels(userId: string, notificationType: string, projectId?: string) {
developer-portal/src/features/abuse-controls/lib/data-layer.ts:909:    return getEnabledChannels(userId, notificationType as any, projectId)
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-910-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-911-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-913-   * Apply default preferences for a new user
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-914-   */
developer-portal/src/features/abuse-controls/lib/data-layer.ts:915:  static async applyDefaults(userId: string): Promise<boolean> {
developer-portal/src/features/abuse-controls/lib/data-layer.ts:916:    return applyDefaultNotificationPreferences(userId)
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-917-  }
/home/ken/developer-portal/src/features/abuse-controls/lib/data-layer.ts-918-
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-queue.ts-423-      `
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-queue.ts-424-      SELECT DISTINCT
developer-portal/src/features/abuse-controls/lib/notification-queue.ts:425:        u.id as user_id,
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-queue.ts-426-        u.email,
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-queue.ts-427-        u.name,
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-queue.ts-430-      JOIN organizations o ON p.org_id = o.id
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-queue.ts-431-      LEFT JOIN organization_members om ON o.id = om.org_id
developer-portal/src/features/abuse-controls/lib/notification-queue.ts:432:      LEFT JOIN users u ON om.user_id = u.id OR o.owner_id = u.id
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-queue.ts-433-      WHERE p.id = $1
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-queue.ts-434-        AND u.id IS NOT NULL
--
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-queue.ts-438-
/home/ken/developer-portal/src/features/abuse-controls/lib/notification-queue.ts-439-    const allRecipients = result.rows.map((row) => ({
developer-portal/src/features/abuse-controls/lib/notification-queue.ts:440:      id: row.user_id,
developer-portal/src/features/abuse-controls/lib/notification-queue.ts-441-      email: row.email,
developer-portal/src/features/abuse-controls/lib/notification-queue.ts-442-      name: row.name || undefined,