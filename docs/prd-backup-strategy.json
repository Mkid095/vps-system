{
  "project": "Backup Strategy",
  "branchName": "flow/backup-strategy",
  "description": "Telegram integration for backups. Manual export API generates SQL dump. Send to Telegram backup. Backup history UI. Restore from backup. Database backups: Coming soon. Storage backups: Handled via Telegram (automatic, files >2GB).",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create Manual Export API",
      "description": "As a developer, I want to export my database so that I can create backups.",
      "acceptanceCriteria": [
        "POST /api/backup/export endpoint",
        "Generates SQL dump using pg_dump",
        "Dumps tenant_{slug} schema only",
        "Returns download URL or file",
        "Async for large databases",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Send Backup to Telegram",
      "description": "As a developer, I want backups sent to Telegram so that I have long-term storage.",
      "acceptanceCriteria": [
        "Integration with Telegram backup bot",
        "Sends SQL dump to Telegram",
        "Generates unique filename",
        "Returns Telegram file ID",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create Backup History Table",
      "description": "As a platform engineer, I want backup history tracked so that I can see all backups.",
      "acceptanceCriteria": [
        "backups table created in control_plane schema",
        "Columns: id, project_id, type, file_id, size, created_at, expires_at",
        "Type enum: database, storage, logs",
        "Index on project_id and created_at",
        "Migration script created",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": []
      },
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Record Backup in History",
      "description": "As a platform engineer, I want backups recorded so that I have an audit trail.",
      "acceptanceCriteria": [
        "Backup recorded after export",
        "Includes: project_id, type, file_id, size",
        "Expiration set (30 days)",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Create Backup UI",
      "description": "As a developer, I want a backup UI so that I can manage backups easily.",
      "acceptanceCriteria": [
        "Backup settings page created",
        "Shows backup history",
        "Export database button",
        "Export logs button",
        "Send to Telegram button",
        "Backup size and date shown",
        "Typecheck passes"
      ],
      "mavenSteps": [
        5,
        10
      ],
      "mcpTools": {
        "step5": [],
        "step10": []
      },
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Implement Restore from Backup",
      "description": "As a developer, I want to restore from backup so that I can recover from data loss.",
      "acceptanceCriteria": [
        "POST /api/backup/restore endpoint",
        "Takes backup_id or file_id",
        "Fetches from Telegram",
        "Restores SQL dump to database",
        "Warning about data overwrite",
        "Async for large backups",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Document Backup Strategy",
      "description": "As a developer, I want clear documentation about backups so that I understand what's covered.",
      "acceptanceCriteria": [
        "Backup documentation page created",
        "Explains: Database backups (manual export)",
        "Explains: Storage backups (Telegram automatic for files >2GB)",
        "Explains: Logs (archived via Telegram)",
        "Shows how to restore",
        "Shows retention policy",
        "Typecheck passes"
      ],
      "mavenSteps": [
        5,
        10
      ],
      "mcpTools": {
        "step5": [],
        "step10": []
      },
      "priority": 2,
      "passes": true,
      "notes": "Documentation created at /home/ken/docs/backup-strategy/README.md and /home/ken/developer-portal/src/app/docs/backups/page.tsx"
    },
    {
      "id": "US-008",
      "title": "Export Logs",
      "description": "As a developer, I want to export logs so that I can archive them externally.",
      "acceptanceCriteria": [
        "POST /api/backup/export-logs endpoint",
        "Exports project_logs to file",
        "JSON or text format",
        "Send to Telegram option",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Backup Retention Policy",
      "description": "As a platform operator, I want backup retention so that storage doesn't grow indefinitely.",
      "acceptanceCriteria": [
        "Backups retained for 30 days",
        "Background job deletes old backups",
        "Cleanup from both database and Telegram",
        "Notification before deletion",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Automatic Storage Backup",
      "description": "As a platform operator, I want automatic storage backups so that large files are preserved.",
      "acceptanceCriteria": [
        "Existing Telegram backup handles files >2GB",
        "Automatic backup documented",
        "No changes needed",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 3,
      "passes": false,
      "notes": ""
    }
  ],
  "relatedPRDs": [],
  "consolidatedMemory": "",
  "lessonsLearned": "",
  "memorialFile": "docs/memory/Backup Strategy.md"
}
